
<!-- saved from url=(0046)http://searle.x10host.com/Multicomp/index.html -->
<html><style>.show_password_icon{cursor:pointer !important;position:absolute !important;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAACjlBMVEVsbGxtbW0mJiYkJCQmJibU1NTh4eEiIiI5OTkWFhZ7e3sYGBjBwcF/f38hISEzMzNMTExwcHAdHR0ICAgmJiZWVlYtLS0hISEkJCQmJiYiIiIPDw8oKCgdHR0LCwsREREVFRUYGBgTExMuLi4oKCgLCwsODg7ExMQtLS0dHR0fHx+2trYrKytvb28+Pj4WFhYVFRUUFBTGxsaqqqoZGRlKSkqEhIRFRUUVFRXNzc00NDQzMzN6enrExMQwMDCzs7MoKCgbGxtYWFivr69DQ0NUVFSrq6sbGxuGhoaNjY06OjoZGRmHh4caGhqzs7NAQEB/f39NTU1BQUG+vr4cHBwdHR2FhYUjIyMkJCQmJiYHBwcHBwcHBwcGBgb///8JCQkwMDAyMjIyMjILCwsMDAwXFxcQEBAuLi4yMjIwMDAwMDD6+votLS0pKSnOzs7///9qamr////////////w8PD29vby8vL///////////////////8AAADl5eWXl5eOjo5JSUlLS0umpqbk5OTKysqampqcnJy7u7ulpaV4eHiYmJiFhYXDw8PFxcWTk5O8vLzU1NSJiYlkZGRSUlKpqam3t7eNjY3g4OCBgYHQ0NCqqqpGRkY7Ozs8PDxDQ0N3d3c/Pz9hYWFCQkIuLi5ycnKWlpZ7e3tTU1OioqJFRUXx8fFzc3NHR0dISEgxMTHh4eFiYmI0NDSQkJBRUVFBQUFeXl4iIiLLy8tKSkrv7+/y8vIyMjIBAQEODg4mJiYCAgINDQ0LCwsoKCgJCQkICAgqKioQEBArKyswMDAkJCQZGRkcHBwaGhoEBAQjIyMSEhIeHh4VFRUXFxcvLy////8TExMGBgYfHx8hISEtLS1dAXVSAAAAfXRSTlP+/B9vD+J3oN6z02/mVU93fMjbs9vI2y8vLy/bs4+goF8vX6Avx2/2j+4P6U+bt8DuTzuu9qpV209Kp+LpgYHb6Q/iVlk7rq5Vh8xvVX8sncDp0vZvL1Xux28/T3+zT0/Hj18fHy8fHx9vD7MPD66P/18vf+7H26BvHz8PAGffyJwAAAKMSURBVHja7dXVX9tQGAbgzN3d3d3d3X24M5yVetp+c3d3F9yhsJVtDLqxFdYh5UDLf7McSUih3X6744LnJvnek/ciSXPKwX9qL7TRQkx4WGj9J6I+NCw85u+FuNihthZWxcZ5LURPqvdoZbTHQsL0Jq/2JbQuzLb+FKWmJH8QJKekSpFtc4tC4ugKJj3tBNLp1UaBWt8l7Z6YH0yUFyYPtlJF55GGN4DEwM8qYktvtzQXRlSXEuZbSGsU5o5+vj4+vn6dATOuM9NV226xMNxVSVwr0QTjrBObrf2AVl7R2badFkY6q7GcS0hhwuvdqiVDgNqaQ8Z3R3FhmNOFnTlnCQasr0tmEVCbssnYtBS4mQOd2OkSHbvXGU6Z50ag9r4m87OF3JhaLLtEZwLiSC2RmUmP04AxvSFzB+4XloWvpw6T4CLS9yQnT1UgyicBZxek4+uZPXYM8QDk5KESRBte4ICrEpT2NknxrirsAkAvcnJfDaIJDhxw8x2Cyj5SfMxBdO9Bj7eV0kIdnvO55XVYcX8QLa6TMSPxHsY3kOABB0saiDnALGiQuaFj6UQ630EcwLIaYicwc2skVxF7D+PonITUnDAd+EFURAE1wEkD51nEkyBqFA2SkJ7+Wjd+IarWAtX11EfByQwLveOpZXT9CtKL38P+Mmp9JHutvFbAk4cdOYUtXkaK5i9uh72c2hYBbiLGsgX7daSUf9MrXn5j5oWAJGSQmGZlWIzum4BpteM7Ux4UGODvHxAY1CgmjptIa2q1L60pavTibq6F97SRGY7n/fYgLxfpDSAvyCvvi7+6KX78iF0uL8grikMFha7PhKuw4AnSqA3/2u5VfLwGEZp4XtUG/lDaCx78AU3oAkjRRCc1AAAAAElFTkSuQmCC) center center no-repeat !important;padding:0 1px !important;margin:0 !important;border:0 !important;background-size:18px 18px !important;width:18px !important;opacity:0.7 !important;-webkit-transition:opacity 200ms !important;}.show_password_icon:hover{opacity:1 !important;-webkit-transition:opacity 200ms !important;}</style><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<title>Grant's MULTICOMP pick and mix computer</title>
<script charset="utf-8" src="./Grant&#39;s MULTICOMP pick and mix computer_files/button.856debeac157d9669cf51e73a08fbc93.js.download"></script></head>

<body>
<p><font face="Arial"><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/Logo.jpg" width="600" height="336"></font></p>
<p><b><font size="6" face="Arial">Pick-and-mix to create your own custom computer on a low-cost FPGA 
board<br>
</font><font size="4" face="Arial">(BASIC, Z80, 6502, 6809, 
internal/external RAM, serial/keyboard+monitor, SD-card for CP/M or other 
storage)</font></b></p>
<p><b><font size="5" face="Arial">...step by step design and implementation</font></b></p>

<p><i><b><font face="Arial" size="4" color="#800080">PAGE STILL BEING UPDATED REGULARLY<br>
Please come back again (and REFRESH the browser page) to see if there are updates.</font><font face="Arial" size="5" color="#800080"><br>
</font></b></i><b><i><font face="Arial" size="4" color="#FF0000">IMPORTANT:
</font></i></b><i><b><font face="Arial" size="4" color="#FF0000">Due to code 
updates, please make sure you have latest files before using this page.</font><font face="Arial" size="5" color="#800080"><br>
&nbsp;</font></b></i></p>

<p><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/Verified.jpg" width="250" height="56"></p>

<p><font face="Arial">by Grant Searle</font></p>

<p>

<font face="Arial"><font color="#0000FF">For news and updates, follow me on 
Twitter:</font><br>
<iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="twitter-follow-button twitter-follow-button-rendered" style="position: static; visibility: visible; width: 84px; height: 28px;" title="Twitter Follow Button" src="./Grant&#39;s MULTICOMP pick and mix computer_files/follow_button.2f70fb173b9000da126c79afe2098f02.en.html" data-screen-name="zx80nut"></iframe>
<script id="twitter-wjs" src="./Grant&#39;s MULTICOMP pick and mix computer_files/widgets.js.download"></script><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</font>

</p>

<p><font face="Arial"><i>Last update: </i></font><i><font face="Arial">26th 
September 2014 9:30am BST</font></i></p>

<p><i><font color="#800000" size="4" face="Arial"><b>Please 
note that you are NOT allowed to reproduce <u>any</u> of this page elsewhere on 
the Web without my permission.</b></font></i></p>

<hr>

<p><i><font face="Arial" size="2"><b>Major update history (minor updates not 
included here):</b><br>
6th February 2014 - Initial release of this page.<br>
7th February 2014 - ANSI cursor and screen colour codes and examples added
<a href="http://searle.x10host.com/Multicomp/index.html#ANSICodes">below</a>. Implemented BASIC keywords for the 6502 and 6809 
BASIC <a href="http://searle.x10host.com/Multicomp/index.html#BASICKeywords">below</a>.<br>
7th February 2014 PM - Change n_int to n_int1, added SD card interface VHDL, 
added SD card clock. Updated SD and top level VHDL in ZIP file. PLEASE GET 
LATEST ZIP TO USE THIS PAGE.<br>
8th February 2014 AM - Z80 BASIC no longer needs interrupts (due to buffering 
done in my serial VHDL). Replaced Z80 BASIC ROM files in ZIP and changed "n_int" 
connection in the Z80 CPU VHDL below. PLEASE GET 
LATEST ZIP TO USE THIS PAGE.<br>
9th February 2012 PM - Video out "SBCTextDisplayRGB.vhd" now ignores code $07 
(bell). ZIP updated. No other change required.<br>
10th February 2012 PM - De-glitcher added to serial input to prevent occasional 
invalid chars read - now 100% reliable. Needs a "clk" passed to the "bufferedUART". 
Serial interface VHDL below and ZIP updated. "SBCTextDisplayRGB.vhd" - ANSI 
top-left changed to (1,1) instead of (0,0).<br>
11th February 2014 - Inverse and bold ANSI atts now supported. Added option to change 
default character attribute in display VHDL below.<br>
12th February 2014 - ANSI "graphics rendition" now allows up to 8 parameters. ZIP 
updated, no VHDL change needed.<br>
14th February 2014 - Various changes to reduce FPGA resources used in the serial 
and monitor/kb code. Buffer sizes reduced and ANSI "graphics rendition" reduced 
to 4 parameters. This has freed up approx 450 logic elements. KB clock filter 
changed to match my implementation in the serial port. KB clock write phase 
changed (thanks to David Bell for his analysis and feedback - appreciated!)<br>
15th February 2014 - ANSI handling of delete line and insert line added. SBCTextDisplayRGB.vhd, 
DisplayRam1K and DisplayRam2K needed updates to handle this. Z80 BASIC keywords
<a href="http://searle.x10host.com/Multicomp/index.html#BASICKeywords">added</a> to this page<br>
17th February 2014 - CP/M implementation and all files provided
<a href="http://searle.x10host.com/Multicomp/index.html#ProjectCPM">here</a>.<br>
3rd March 2014 - Board schematic added.<br>
26th September 2014 - 6809 CPU core updated using a new version provided by the 
author, John Kent. Many thanks to John for his support for this core.<b> Please 
get the latest files <a href="http://searle.x10host.com/Multicomp/index.html#SoftwareDownload">here</a>. 
Important: the 6809 include code is modified slightly to use the updated core - ensure you use the 
slightly VHDL updated text shown later on this page when using the new 
cpu09l.vhd file. If using an existing project then extract the new file and put 
it in the M6809 folder, then remove the previous 6809 file. You will then need 
to include the new file in your project within Quartus. The zip already contains 
all changes needed to the project file.</b></font></i></p>
<hr>

<p><b><font face="Arial" size="5">
Index</font></b></p>

<p><font face="Arial"><a href="http://searle.x10host.com/Multicomp/index.html#Introduction"><font size="2">Introduction</font></a><font size="2"><br>
<a href="http://searle.x10host.com/Multicomp/index.html#Acknowledgements">Acknowledgements</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#ToolsNeeded">Tools needed</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#AboutTheBoard">Notes about the board / schematic</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#Specifications">Specifications</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#Planning">Planning the computer</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#Stuck">Stuck on what to choose?</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#TheBuild">The build</a><br>
&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#HardwareWiring">Hardware wiring</a><br>
&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#VHDLWiring">VHDL "wiring"</a><br>
&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#AddingTheBlocks">Adding the blocks</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#CPU">CPU</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#ROMs">ROMs</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#ProgramRAM">Program RAM</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://searle.x10host.com/Multicomp/index.html#InternalRAM">Internal RAM</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://searle.x10host.com/Multicomp/index.html#ExternalSRAM">External SRAM</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#Interfaces">Interfaces</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://searle.x10host.com/Multicomp/index.html#SerialInterface">Serial port</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://searle.x10host.com/Multicomp/index.html#TVKeyboardInterface">TV/monitor and a PS2 keyboard</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://searle.x10host.com/Multicomp/index.html#SDCard">SD Card</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#ReadWriteSignals">
Read/write signals</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#ChipSelects">Chip selects</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#BusIsolation">Bus isolation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#Clocks">The clocks</a><br>
&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#AssigningConnections">Assigning the internal 
connections to actual pins</a><br>
&nbsp;&nbsp;&nbsp; <a href="http://searle.x10host.com/Multicomp/index.html#BuildCompletion">Build completion</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#ANSICodes">ANSI Codes supported</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#BASICKeywords">ROM BASIC - implemented keywords and tokens</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#SoftwareDownload">Software and VHDL project download link</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#Examples">Worked examples - if you get stuck</a><br>
<a href="http://searle.x10host.com/Multicomp/index.html#ProjectCPM">Extension project 1: CP/M</a><br>
</font><a href="http://searle.x10host.com/Multicomp/index.html#MyOtherPages"><font size="2">My other pages</font></a></font></p>

<hr>

<p><b><font face="Arial" size="5">
<a name="Introduction"></a>Introduction</font></b></p>

<p><font face="Arial">On my other pages, I have information on how to construct 
simple 6502, 6809 or Z80 designs using the minimal amount of discrete 
components. This page allows you to take each of those designs and many other 
configurations and build them 
within an FPGA on a very low-cost board.</font></p>

<p><font face="Arial">I will take you through the decisions you need to make and 
all the coding that you need to do to build the computer to your own 
specification. You choose the processor, whether you want a display/keyboard or 
just serial ports, how much RAM you want and what speed you want it to run at. 
All VHDL is provided so you can change the individual components to exactly 
match your requirements. Design will take the form of building on a VHDL 
breadboard (skeleton code and signals already provided for you) which will then 
have the component VHDL added within it to complete the design.</font></p>

<p><font face="Arial">The smallest configurations will all fit within the one 
FPGA chip. Larger memory configurations only require a single SRAM chip to be 
added.</font></p>

<p><font face="Arial">To connect a monitor/TV and keyboard very few components 
are needed - just a few resistors and connectors.</font></p>

<p><font face="Arial">As a result, a complete and very fast computer can be 
built in a very small enclosure if needed.</font></p>

<p><font face="Arial">The final cost of this is surprisingly low (<b>no need to 
buy the very expensive project boards</b>) - a very low cost board is easily 
available that has most of what is required - very few additional (low cost) 
parts are needed.</font></p>
<p><font face="Arial">This page is not intended as an introduction to VHDL - 
there are many pages already explaining that, but this will take you through the 
complete design and implementation. You can, or course, just take the VHDL project that I 
created and use it immediately - but it's important to understand what I did so 
that you can do the same yourself.</font></p>
<p><font face="Arial">Important note: FPGA I/O pins normally have 3.3V levels, 
NOT 5V, so be careful when interfacing to TTL and CMOS parts.</font></p>
<p><font face="Arial">The board and keyboard takes less than 100mA so could be 
powered from batteries if needed.</font></p>
<p><font face="Arial">The board that is used in this article measures only 72mm 
x 51mm (2 7/8" x 2") so a very small case can be used if needed.</font></p>
<p><font face="Arial">The board is available from many sources, eBay suppliers 
probably the easiest and cheapest (search for <font color="#0000FF">EP2C5T144C8N 
mini board</font>) .</font></p>
<hr>
<p><b><font face="Arial" size="5"><a name="Acknowledgements"></a>
Acknowledgements</font></b></p>
<p><font face="Arial">Before I continue, I feel it is important to acknowledge 
all other's work that I have used.</font></p>
<p><font face="Arial"><b>Z80 CPU core</b> - written by Daniel Wallner and is on 
the "opencores" website<br>
<b>6502 CPU core</b> - written by Daniel Wallner and is on the "opencores" 
website, bugfixes by "Mike J" and "ehenciak"<br>
<b>6809 CPU core</b> - written by John E. Kent and is on the "opencores" website<br>
<b>6800 CPU core</b> (not used YET) - written by John E. Kent<br>
<b>SD card interface</b> - my own adaptation from partial code originally 
published by Steven J Merrifield<br>
<b>BASIC interpreter</b> for the Z80, 6502 and 6809 - Microsoft corporation 
(modifications and interface code all my own work)<br>
<b>CGA Font ROM</b> - IBM<br>
<b>Quartus II</b> software and <b>memory IP</b> components - Altera</font></p>
<p><font face="Arial"><i><b>ALL other diagrams, text, software and VHDL are MY 
OWN WORK</b></i><br>
&nbsp;</font></p>
<p><font face="Arial">Personal acknowledgements for feedback and encouragement 
to Graeme and also to David Bell. Your support has been greatly appreciated.</font></p>
<hr>
<p><b><font face="Arial" size="5"><a name="ToolsNeeded"></a>Tools needed</font></b></p>
<p><font face="Arial">FPGA development software - Altera Quartus II 13 sp1 (<b>Do 
<u>not</u> use newer versions</b> - Cyclone II FPGAs are not supported with newer versions)<br>
FPGA USB programmer (USB-blaster or similar)<br>
Low-cost Altera FPGA board (EP2C5T144C8N Cyclone II FPGA on a mini board although any larger board/FPGA can be used)</font></p>
<p><font face="Arial">Additional components<br>
(See the wiring diagram below for further details)</font></p>
<p><font face="Arial">PS2 keyboard:<br>
<font size="2">2x 10K resistors<br>
PS/2 connector<br>
PC keyboard with a PS/2 (round) connector</font></font></p>
<p><font face="Arial">Monochrome video out:<br>
<font size="2">RCA ("phono") connector for the <br>
1K resistor<br>
470R resistor</font></font></p>
<p><font face="Arial">RGB video VGA monitor out:<br>
<font size="2">3 x 680R resistors<br>
3 x 470R resistors<br>
15 pin VGA socket</font></font></p>
<p><font face="Arial">RGB video SCART TV monitor out:<br>
<font size="2">3 x 680R resistors<br>
4 x 470R resistors<br>
1 x 100R resistor<br>
21 pin SCART socket</font><br>
<br>
Serial interface: <br>
<font size="2">3.3V USB to serial board (or serial voltage converter if 
connecting to a serial port on another terminal/pc)</font></font></p>
<p><font face="Arial">SD card interface:<br>
<font size="2">Suitable SD or microSD socket<br>
2GB SD Card (NOT SDHC at the moment)</font></font></p>
<p><font face="Arial">5V Power supply with suitable connector for the board<br>
Breadboard/PCB<br>
Wires with ends that can plug onto the pins on the board<br>
&nbsp;</font></p>
<hr>
<p><b><font face="Arial" size="5"><a name="AboutTheBoard"></a>Important notes 
regarding the board being used</font></b></p>
<p><font face="Arial">A schematic is available but was very spread out. I have 
compressed it to an image that can still be read when printed on A4.</font></p>
<p><font face="Arial">This schematic of the board is available
<a href="http://searle.x10host.com/uk101FPGA/MiniboardSchema.gif">HERE</a> (right-click and "Save as").</font></p>
<p><a href="http://searle.x10host.com/uk101FPGA/MiniboardSchema.gif">
<img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/MiniBoardSchemaSmall.jpg" width="300" height="233"></a></p>
<p><font face="Arial">As you will see on the schematic, some FPGA pins on the 
board have connections made, so need to be accounted for when doing this or 
other designs on it...</font></p>
<p><font face="Arial">To summarise the pins that are available on the connectors 
that need consideration...</font></p>
<p><font face="Arial">Pin 3 - LED 1 (D2 on board) - low to light<br>
Pin 7 - LED 2 (D4 on board) - low to light<br>
Pin 9 - LED 3 (D5 on board) - low to light<br>
Pin 144 - pushbutton to ground, no external pullup. Set internal pullup on FPGA 
configuration if used. I will use for UK101 "reset"<br>
Pin 17 - 50MHz clock input<br>
Pin 73 - 10uF capacitor to ground, 10K resistor to Vcc, for power up reset if 
needed?<br>
Pin 26 - Connected to Vcc 1.2V - only needed for EPC28 though, so the "zero ohm" 
resistor could be removed and the pin used as normal.<br>
Pin 27 - Connected to GND - only needed for EPC28 though, so the "zero ohm" 
resistor could be removed and the pin used as normal.<br>
Pin 80 - Connected to GND - only needed for EPC28 though, so the "zero ohm" 
resistor could be removed and the pin used as normal.<br>
Pin 81 - Connected to Vcc 1.2V - only needed for EPC28 though, so the "zero ohm" 
resistor could be removed and the pin used as normal.</font></p>
<hr>

<p><b><font face="Arial" size="5"><a name="Specifications"></a>Specifications</font></b></p>

<p><font face="Arial">6502, 6809 or Z80 processor running at up to 25MHz</font></p>

<p><font face="Arial">Microsoft BASIC in ROM (copyright of the original 
respectfully acknowledged)</font></p>

<p><font face="Arial">Serial ports (can support several) up to 115200 baud</font></p>

<p><font face="Arial">PC monitor or TV (PAL/NTSC) with fully configurable 40x25, 80x25, 
68x30 (or <u>many</u> other formats) monochrome 
or 16 colour display. Character sizes also configurable. Standard ANSI interpreter built-in to control cursor and 
colours.</font></p>

<p><font face="Arial">PS2 (standard PC keyboard with round plug) keyboard with 
LED support.</font></p>

<p><font face="Arial">SD card interface for CP/M or other use (simple interface 
for use within BASIC or machine code). Not SDHC currently, but could be done.</font></p>

<p><font face="Arial">
<img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/miniBoard.jpg" width="400" height="309"></font></p>

<hr>

<p><b><font face="Arial" size="5"><a name="Planning"></a>Planning the computer</font></b></p>

<p><font face="Arial">This computer is not based on any existing design, so the 
final configuration is entirely up to you (I will provide a couple of ready-made 
examples to get you started, though, if needed).</font></p>

<p><font face="Arial">The following questions need to be answered before 
proceeding.</font></p>

<p><font face="Arial">1. CPU type - options are:<br>
6502<br>
Z80<br>
6809</font></p>

<p><font face="Arial">2. Interface - pick-and-mix options are:<br>
Mono ("black and white") video and a PS2 keyboard<br>
RGB ("colour") video (can be TV RGB/SCART or PC "VGA") and a PS2 keyboard<br>
Serial RS232 compatible</font></p>

<p><font face="Arial">There is an option of a second interface which can be an 
additional serial port (actually able to add several serial ports if needed).</font></p>

<p><i><b><font face="Arial">Note: The supplied BASIC will use the first 
interface ONLY when performing I/O. To access the second interface, you can use 
PEEK/POKE (6502 or 6809) or IN/OUT (Z80) to read or write to it. The display/keboard 
and serial ports use an identical interface fully software compatible with the 
6850 ACIA. You can also change the ROM code as needed (source supplied). 
Alternatively, if using the PS2 keyboard interface, you can use one of the 
supplied "FN Key" output signals to toggle the active input/output between 
interface 1 and interface 2. That way, you can use keyboard/monitor as the first 
interface and a serial connection as the second interface then switch interfaces 
to load/save programs via the serial port. This option is straightforward and 
will be published at a later date.</font></b></i></p>

<p><font face="Arial">3. Memory:<br>
Internal RAM - 1K up to 4K (no external SRAM chip needed)<br>
External RAM - up to full 64K address space (not all accessible due to ROM 
taking part of the address). Can use 2KB, 8KB, 32KB, 128KB(only 64KB used) 
external SRAM.</font></p>

<p><font face="Arial">Once decided, you need to see if what you have chosen will 
fit into the chip.</font></p>

<p><font face="Arial">The main constraints will be memory space on the chip. 
Using a TV display requires use of memory within the FPGA for the display RAM, 
colour attributes RAM (if colour per character chosen) and the character definitions ROM (128 
or 256 characters).</font></p>

<p><font face="Arial">The FPGA on this board holds 26 x 0.5Kbyte memory blocks (ie. 
13K total).<br>
The memory requirements of the component blocks are as follows:</font></p>

<p><font face="Arial">BASIC ROM for each of the 6502, 6809 or Z80 - 8K<br>
<br>
ROM/RAM for mono 80x25 display - 5K (2K RAM, 2K Character ROM)<br>
ROM/RAM for mono 80x25 display, reduced character set - 3K (2K RAM, 1K Character 
ROM)<br>
ROM/RAM for colour 80x25 display - 6K (4K RAM, 2K Character ROM) *<br>
ROM/RAM for colour 80x25 display, reduced character set - 5K (4K RAM, 1K 
Character ROM)<br>
ROM/RAM for colour 40x25 display - 4K (2K RAM, 2K Character ROM)<br>
ROM/RAM for colour 40x25 display, reduced character set - 3K (2K RAM, 1K 
Character ROM)<br>
&nbsp;</font></p>

<p><font face="Arial">ie. <br>
Character RAM will be either 1K or 2K depending on the number of characters that 
you choose to display.<br>
Colour attribute RAM will be the same size as the character RAM if you require 
colour specified for each character, otherwise it will not be used/required.<br>
Character ROM will be either 1K or 2K depending on whether you need the standard 
(128) character set or extended DOS (256) character set.</font></p>

<p><font face="Arial">So, a 6502 with mono 80x25 display, reduced character set 
would require 8+3=11K, leaving 2K RAM/ROM spare. Therefore you could also have 
2K RAM internally.<br>
* - The colour 80x25 display, full character set can't be used unless a smaller 
ROM is used (eg. tiny BASIC or a monitor/bootloader for CP/M etc).</font></p>

<p><font face="Arial">Having checked what is required can actually fit, the 
build can proceed. If not sure, build a smaller configuration first then alter 
as needed.</font></p>

<hr>

<p><b><font face="Arial" size="5"><a name="Stuck"></a>Stuck on what to choose?</font></b></p>

<p><font face="Arial">There are so many possibilities that you may not know what 
needs to be picked to start.</font></p>

<p><font face="Arial">Here are some <b><u>suggestions</u></b> for the smaller 
configurations to get you started</font></p>

<p><b><font face="Arial">No external SRAM chip</font></b></p>

<p><font face="Arial">Monochrome video and PS2 keyboard, 80x25 text display, 2K 
internal RAM, 6502 processor</font></p>

<p><font face="Arial">Serial connection only, 4K internal RAM, Z80 processor</font></p>

<p><font face="Arial">Colour video, VGA monitor, 40x25 display, 2K internal RAM, 
6809 processor</font></p>

<p><b><font face="Arial">External SRAM chip</font></b></p>

<p><font face="Arial">Colour video, VGA monitor, 80x25 display, 56K external 
RAM, Z80 processor</font></p>

<p>&nbsp;</p>

<p><font face="Arial">Pick your configuration then proceed through the rest of 
the page using that configuration. When you reach the end you should have a 
working computer.</font></p>

<p>&nbsp;</p>

<hr>

<p><b><font face="Arial" size="5"><a name="TheBuild"></a>The build</font></b></p>

<p><font face="Arial">Building this machine is partly electronic and partly 
software (VHDL).</font></p>

<p><b><font face="Arial" size="4"><a name="HardwareWiring"></a>Hardware wiring</font></b></p>

<p><font face="Arial">The electronic part depends on how much functionality you 
want to provide.</font></p>

<p><font face="Arial">With ALL options installed and using the connections that 
I have defined in the files, the complete expanded build would be connected as 
follows:</font></p>

<p><font face="Arial"><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/MulticompOnFPGA.jpg" width="800" height="692"></font></p>

<p><font face="Arial">However, if you want a simpler machine (eg. internal RAM, 
monochrome TV monitor output and a PS2 keyboard) then the connections would be 
reduced to...</font></p>

<p><font face="Arial">
<img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/MulticompOnFPGASimple.jpg" width="800" height="339"></font></p>

<p><font face="Arial">ALL configurations use the same pinout, so you could start 
with a simpler configuration then upgrade as needed.</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4">Suggested serial connection</font></b></p>

<p><font face="Arial">Serial 1 and Serial 2 can be connected to a USB to TTL (3.3V 
or 5V) serial cable 
as shown below.</font></p>
<p><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/FTDI_FPGACable.jpg" width="650" height="235"></p>
<p><font face="Arial">By using a USB to serial cable the board can also be 
powered from the USB port down the same cable (a powered hub could be used if 
higher current needed), eliminating the need for a separate power supply for 
this board. Just connect the +5V out on the cable to the centre pin of the 5V 
input supply on the board.<br>
<br>
The 2k7 resistors are present in the diagram because the board may be powered 
but not plugged in to the USB cable, or the USB cable could be plugged in and 
active without power to the board. These limit the current  to 
avoid power being drawn through the interface pins. If always powering the board 
via the cable then no resistors are necessary.</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4"><a name="VHDLWiring"></a>VHDL "wiring"</font></b></p>

<p><i><b><font face="Arial">The only file that you are required to edit is "Microcomputer.vhd" 
which I have provided in the set of project files. Open the Microcomputer.qpf 
project file in Quartus II, then double-click the "Microcomputer" entity you see 
in the "project explorer" window. This will open the "Microcomputer.vhd" file in 
the editor window. You then follow my instructions below to complete the VHDL 
for your project.</font></b></i></p>

<p><b><i><font face="Arial">IMPORTANT: Ensure you follow the complete page as 
there are may be several entries needed to incorporate a component into the 
design. If you have a problem, please re-read the page carefully to ensure you 
haven't missed out any steps.</font></i></b></p>

<p><font face="Arial">The bare breadboard VHDL is used and the relevant 
component VHDL added to it. All components that can be used have been added to 
the project file, so only changes to the top level VHDL is needed.<br>
&nbsp;</font></p>

<p><b><font face="Arial">The bare VHDL (the "breadboard)</font></b></p>

<p><font face="Arial">The following diagram illustrates the concept involved 
here.</font></p>

<p><font face="Arial"><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/MulticompBreadboardBare.jpg" width="1000" height="529"></font></p>
<p><font face="Arial">The architecture of a VHDL projects consists of the "top 
level" code and components that can be added to it.</font></p>
<p><font face="Arial">For this set of projects, all will use the same top level 
(effectively a bare circuit board with some connections already in place to plug 
in to).</font></p>
<p><font face="Arial">The structure is as follows:<br>
library definitions<br>
</font>
<font size="2" face="Arial"><font color="#0000FF">entity Microcomputer is<br>
port(</font><br>
signals that are to be connected to actual pins on the chip<br>
<font color="#0000FF">);<br>
end Microcomputer;<br>
architecture struct of Microcomputer is</font><br>
signals ("wires") used within the system that are used to interconnect the 
components</font><font face="Arial"><br>
</font>
<font size="2" face="Arial"><font color="#0000FF">begin</font><br>
the VHDL definition of logic operations (glue etc) and connections to components<br>
the components being used are also included in here and attached to the 
appropriate "wires"<br>
<font color="#0000FF">end;</font></font></p>
<p>&nbsp;</p>
<p><font face="Arial">The VHDL used as the base (breadboard) is shown here.</font></p>
<p><font face="Arial" size="2" color="#0000FF">library ieee;<br>
use ieee.std_logic_1164.all;<br>
use IEEE.STD_LOGIC_ARITH.all;<br>
use IEEE.STD_LOGIC_UNSIGNED.all;<br>
<br>
entity Microcomputer is<br>
port(<br>
<br>
<i>:<br>
SIGNALS THAT CONNECT EXTERNALLY ARE ALREADY DEFINED HERE<br>
:</i><br>
<br>
);<br>
end Microcomputer;<br>
<br>
architecture struct of Microcomputer is<br>
<br>
<i>:<br>
VARIOUS PREDEFINED BREADBOARD SIGNALS HERE<br>
:</i><br>
<br>
begin<br>
-- 
____________________________________________________________________________________<br>
-- CPU CHOICE GOES HERE<br>
<br>
-- 
____________________________________________________________________________________<br>
-- ROM GOES HERE <br>
<br>
-- 
____________________________________________________________________________________<br>
-- RAM GOES HERE<br>
<br>
-- 
____________________________________________________________________________________<br>
-- INPUT/OUTPUT DEVICES GO HERE <br>
<br>
-- 
____________________________________________________________________________________<br>
-- MEMORY READ/WRITE LOGIC GOES HERE<br>
<br>
-- 
____________________________________________________________________________________<br>
-- CHIP SELECTS GO HERE<br>
<br>
-- 
____________________________________________________________________________________<br>
-- BUS ISOLATION GOES HERE<br>
<br>
-- 
____________________________________________________________________________________<br>
-- SYSTEM CLOCKS GO HERE<br>
<br>
end;</font></p>
<p><font face="Arial">As you can see when you look at the file, the common wires used within a 
microcomputer system have been defined and are ready to be connected to. During 
construction, not all may be used. The unused ones can be removed if needed 
(don't have to) once the construction is complete.</font></p>
<p><font face="Arial">Every microcomputer system has the following:<br>
A clock to drive the system components (cpu and interface)<br>
CPU - the main processor, such as a Z80, 6502, 6809 etc.<br>
RAM - volatile memory for user programs and data<br>
ROM - non-volatile holding I/O routines and a monitor and/or language code<br>
Inputs - could be switches, pins, keyboard, serial etc.<br>
Outputs - could be LEDs, pins, video (monitor), serial etc.</font></p>
<p><font face="Arial">Looking at the breadboard VHDL, you will see there are 
sections to be completed during the construction to include the relevant 
components to make up the complete system.</font></p>
<p><font face="Arial">I have already included ALL components in the VHDL 
project, so once open in Quartus II, you just add the relevant components into 
the above code. Once complete, compile and upload to the FPGA and you should (if 
all done correctly) have a working computer ready to use.</font></p>
<p>&nbsp;</p>
<p><b><font face="Arial" size="4"><a name="AddingTheBlocks"></a>Adding the blocks</font></b></p>
<p><font face="Arial">Each component is defined and attached in the following 
way.</font></p>
<p><font face="Arial">1. Include the required component VHDL file within the 
project<br>
2. Create a VHDL entry within the top-level code, defining the "instance" name 
of the component, the actual VHDL to use (as imported) and then map the signals 
to the I/O signals defined in the component.</font></p>
<p><font face="Arial" color="#0000FF" size="2">instanceName<b> : entity work.</b>VHDLName<br>
<b>port map(</b><br>
ComponentSignal1 <b>=&gt;</b> Signal1DefinedInTopLevelVHDL,<br>
ComponentSignal2<b> =&gt;</b> Signal2DefinedInTopLevelVHDL,<br>
:<br>
ComponentSignalN <b>=&gt;</b> SignalNDefinedInTopLevelVHDL<b>);</b></font></p>
<p>&nbsp;</p>
<p><b><font face="Arial"><a name="CPU"></a>Decide on the central processor (CPU) that you want to 
use and add it.</font></b></p>
<p><font face="Arial">This needs to be decided first because it will decide 
which ROMs and interface connections are needed.</font></p>
<p><font face="Arial">These are all existing "components" that are available on 
the net. No particular standard was used as they were all created independently 
so there is a difference to the naming of the signals that are internal to them 
and some have active high and some have active low connections. However, as I 
will show here, all can be connected to our existing breadboard connections by 
taking the appropriate component signal to the breadboard signal.</font></p>
<p><font face="Arial">The CPUs on offer here are typical and share the following 
characteristics:<br>
A 16-bit address bus. For full access to the address space, all 16 connections 
are made (A0...A15). The appropriate address signals are therefore connected to 
the address bus already set on the breadboard.<br>
eg.<br>
</font><font face="Arial" size="2" color="#0000FF">a =&gt; cpuAddress,</font></p>
<p><font face="Arial">Similarly, all these CPUs have an 8-bit data bus. 
For the discrete components, the data bus is bidirectional. This could have been 
implemented in VHDL as bidirectional to match. However, the VHDL components 
(including RAM and ROM) tend to have separate incoming and outgoing data buses - 
this makes it easier to interface. Therefore the 8-bit data bus found on a CPU 
is represented as two separate data buses and are connected to the two data 
buses on the breadboard.</font><font face="Arial" size="2"><br>
eg<br>
<font color="#0000FF">di =&gt; cpuDataIn,<br>
do =&gt; cpuDataOut</font></font></p>
<p><font face="Arial">Additionally, CPUs need signals to identify to 
memory and peripherals whether read or writes are active (plus the Z80 has the 
ability to have memory access or IO access). These additional signals are again 
connected to the wires already set out on the breadboard VHDL.<br>
eg. <br>
n_WR - "not write" - "0" when a write is active (for CPUs other than the Z80, a 
"1" on here implies a read is active)<br>
n_RD - "not read" (Z80 only) - "0" when a write is active<br>
n_IORQ (Z80 only)<br>
n_MEMRQ (Z80 only)<br>
n_INT1 - this is an input to the CPU to inform it that a peripheral will <u>
request</u> to interrupt the current process ("0" - interrupt request activated)<br>
Other inputs to the processors that are not used are connected to the 
appropriate logic levels ( =&gt; '1' (high) or =&gt; '0' (low) ) to allow them to 
work.</font></p>
<p><font face="Arial">You have three choices. Pick one of these and copy and 
paste the relevant code into the above where it says "CPU 
CHOICE GOES HERE".</font></p>
<p><font face="Arial">The choices are:</font></p>
<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="1200" id="AutoNumber3">
  <tbody><tr>
    <td width="33%"><font face="Arial">6502</font></td>
    <td width="33%"><font face="Arial">Z80</font></td>
    <td width="34%"><font face="Arial">6809<i><b> <font size="2">(updated 26th 
    Sep 2014 to use new core. If your zip is older than this then please get the 
    new version later in this page)</font></b></i></font></td>
  </tr>
  <tr>
    <td width="33%"><font size="2" color="#0000FF" face="Arial">cpu1 : entity 
    work.T65<br>
    port map(<br>
    Enable =&gt; '1',<br>
    Mode =&gt; "00",<br>
    Res_n =&gt; n_reset,<br>
    Clk =&gt; cpuClock,<br>
    Rdy =&gt; '1',<br>
    Abort_n =&gt; '1',<br>
    IRQ_n =&gt; '1',<br>
    NMI_n =&gt; '1',<br>
    SO_n =&gt; '1',<br>
    R_W_n =&gt; n_WR,<br>
    A(15 downto 0) =&gt; cpuAddress,<br>
    DI =&gt; cpuDataIn,<br>
    DO =&gt; cpuDataOut);</font></td>
    <td width="33%"><font size="2" color="#0000FF" face="Arial">cpu1 : entity 
    work.t80s<br>
    generic map(mode =&gt; 1, t2write =&gt; 1, iowait =&gt; 0)<br>
    port map(<br>
    reset_n =&gt; n_reset,<br>
    clk_n =&gt; cpuClock,<br>
    wait_n =&gt; '1',<br>
    int_n =&gt; '1',<br>
    nmi_n =&gt; '1',<br>
    busrq_n =&gt; '1',<br>
    mreq_n =&gt; n_MREQ,<br>
    iorq_n =&gt; n_IORQ,<br>
    rd_n =&gt; n_RD,<br>
    wr_n =&gt; n_WR,<br>
    a =&gt; cpuAddress,<br>
    di =&gt; cpuDataIn,<br>
    do =&gt; cpuDataOut);</font></td>
    <td width="34%"><font size="2" color="#0000FF" face="Arial">cpu1 : entity 
    work.cpu09<br>
    port map(<br>
    clk =&gt; not(cpuClock),<br>
    rst =&gt; not n_reset,<br>
    rw =&gt; n_WR,<br>
    addr =&gt; cpuAddress,<br>
    data_in =&gt; cpuDataIn,<br>
    data_out =&gt; cpuDataOut,<br>
    halt =&gt; '0',<br>
    hold =&gt; '0',<br>
    irq =&gt; '0',<br>
    firq =&gt; '0',<br>
    nmi =&gt; '0'); </font></td>
  </tr>
</tbody></table>
<p><font face="Arial">The copied text has defined an instance of a CPU 
component and assigned all the necessary signals to the connections on the 
breadboard VHDL. This has inserted the CPU into the design - easy enough!</font></p>
<p>&nbsp;</p>
<p><b><font face="Arial"><a name="ROMs"></a>ROMs</font></b></p>
<p><font face="Arial">I have already prepared ROM code for the Z80, 
6502 and 6809 designs and is virtually the same as you will see on my other "build your 
own computer" pages. The VHDL version directly replicates the discrete component 
version of the design (apart from moving the ACIA address) so the ROM code can run 
virtually unchanged (no changes apart from that ACIA address change) within this FPGA. 
The 6809 Extended BASIC ROM has been reduced to fit into an 8K ROM by removing 
the "PRINT USING" routine.</font></p>
<p><font face="Arial">ROMs consist of the following signals:<br>
address bus - to specify which location in the ROM will be accessed<br>
q - data OUT from the ROM<br>
Additionally, because the VHDL is a synchronous device, there is normally a 
clock input to allow the data to be registered to the output</font></p>
<p><font face="Arial">Depending on which processor you have chosen will 
depend on which ROM is needed.</font></p>
<p><font face="Arial">The ROMs can either use the built-in block memory 
in the FPGA or can be defined as an "array" which is then synthesized by the 
VHDL compiler into a complex combinational logic model. I am using the standard 
memory model ("M4K") available within the Altera suite. If using another 
manufacturer's FPGA then there would be an equivalent model. The HEX file that 
would be loaded into the memory block during compilation is included.</font></p>
<p><font face="Arial">Copy and paste the appropriate ROMs into the 
breadboard VHDL where it says "ROM GOES HERE".</font></p>
<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="1200" id="AutoNumber2">
  <tbody><tr>
    <td width="33%"><font face="Arial">6502</font></td>
    <td width="33%"><font face="Arial">Z80</font></td>
    <td width="34%"><font face="Arial">6809</font></td>
  </tr>
  <tr>
    <td width="33%"><font face="Arial" size="2" color="#0000FF">rom1 : entity 
    work.M6502_BASIC_ROM -- 8KB BASIC<br>
    port map(<br>
    address =&gt; cpuAddress(12 downto 0),<br>
    clock =&gt; clk,<br>
    q =&gt; basRomData<br>
    );</font></td>
    <td width="33%"><font face="Arial" size="2" color="#0000FF">rom1 : entity 
    work.Z80_BASIC_ROM -- 8KB BASIC<br>
    port map(<br>
    address =&gt; cpuAddress(12 downto 0),<br>
    clock =&gt; clk,<br>
    q =&gt; basRomData<br>
    );</font></td>
    <td width="34%"><font face="Arial" size="2" color="#0000FF">rom1 : entity 
    work.M6809_EXT_BASIC_ROM -- 8KB BASIC<br>
    port map(<br>
    address =&gt; cpuAddress(12 downto 0),<br>
    clock =&gt; clk,<br>
    q =&gt; basRomData<br>
    );</font></td>
  </tr>
</tbody></table>
<p><font face="Arial">The above code will "attach" the ROM address to the bottom 
13 bits (A0..A12) of the CPU address connections to allow the CPU to address all 
8K (2^13 = 8192). The remainig 3 "top" bits of the address bus (A13..A15) must 
then be used in the "chip select" (address decoder) logic to ensure the ROM will 
only appear in one location in the memory space. For the Z80, the ROM needs to 
appear in the bottom 8K, so A13..A15 will be "000". For the 6502 or 6809 the ROM 
needs to appear in the top 8K, so A13..A15 will be "111". You will see this 
address decoding in the "chip select" VHDL code later on this page.</font></p>

<p><font face="Arial">The "q" data output is shown connected to the "basRomData" 
lines - this consists of 8 connections and will be connected to the CPU data 
input only when the ROM is being accessed (only one set of outputs can go to any 
input at the same time) ie. "connect the basRomData to the cpu data input if the 
rom is selected". That process is handled by the "bus isolation" lower on this 
page.</font></p>

<p><font face="Arial"><br>
</font><font face="Arial" size="2" color="#0000FF">
<br>
</font><b><font face="Arial" size="4"><a name="ProgramRAM"></a>Program RAM</font></b></p>

<p><font face="Arial">The choice is to either use internal RAM (1K to 4K available) or 
use an external RAM chip (56K available). If this is your first design, I 
recommend you start without connecting the external RAM chip and get everything 
working internally, so pick the internal RAM option.</font></p>

<p><b><font face="Arial"><a name="InternalRAM"></a>If you require internal RAM</font></b></p>

<p><font face="Arial">I have provided 1K, 2K and 4K memory entities. Choose the 
one that would fit. (it is also possible to have one 1K and one 2K to make 3K 
but that won't be covered here). Different size memories require a different 
amount of address lines, so the entity for each size RAM utilises the required 
number of address lines.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber6">
  <tbody><tr>
    <td width="171">&nbsp;</td>
    <td width="626"><font face="Arial">6502, 6809 or Z80</font></td>
  </tr>
  <tr>
    <td width="171"><font face="Arial">1K</font><p><font face="Arial"><i>
    <font size="2">Note:6809 BASIC won't work with just 1K RAM</font></i></font></p></td>
    <td width="626"><font color="#0000FF" size="2" face="Arial">ram1: entity 
    work.InternalRam1K<br>
    port map<br>
    (<br>
    address =&gt; cpuAddress(9 downto 0),<br>
    clock =&gt; clk,<br>
    data =&gt; cpuDataOut,<br>
    wren =&gt; not(n_memWR or n_internalRam1CS),<br>
    q =&gt; internalRam1DataOut<br>
    );</font></td>
  </tr>
  <tr>
    <td width="171"><font face="Arial">2K</font></td>
    <td width="626"><font color="#0000FF" size="2" face="Arial">ram1: entity 
    work.InternalRam2K<br>
    port map<br>
    (<br>
    address =&gt; cpuAddress(10 downto 0),<br>
    clock =&gt; clk,<br>
    data =&gt; cpuDataOut,<br>
    wren =&gt; not(n_memWR or n_internalRam1CS),<br>
    q =&gt; internalRam1DataOut<br>
    );</font></td>
  </tr>
  <tr>
    <td width="171"><font face="Arial">4K</font></td>
    <td width="626"><font color="#0000FF" size="2" face="Arial">ram1: entity 
    work.InternalRam4K<br>
    port map<br>
    (<br>
    address =&gt; cpuAddress(11 downto 0),<br>
    clock =&gt; clk,<br>
    data =&gt; cpuDataOut,<br>
    wren =&gt; not(n_memWR or n_internalRam1CS),<br>
    q =&gt; internalRam1DataOut<br>
    );</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">Paste the appropriate code where it says "RAM GOES HERE"</font></p>

<p><b><font face="Arial"><a name="ExternalSRAM"></a>If you require external SRAM</font></b></p>

<p><font face="Arial">The external RAM can be 2K, 8K, 32K or 128K (only 64K is 
used). The appropriate RAM pins are connected to the matching connections as 
defined on my wiring diargram earlier. Unused addresses on the FPGA are left 
disconnected. Unused addresses on the RAM chip are connected to Gnd or Vcc.</font></p>

<p><font face="Arial">The chosen size of RAM will affect the chip select code 
that is needed. Explanation and implementation details for the chip select is 
shown further down this page..</font></p>

<p><font face="Arial">Instead of providing an internal component, what is needed is to assign the external signals 
(connected to the pins on the RAM chip and the FPGA) to the internal signals on 
the VHDL. This is done as follows. </font></p>

<p><font face="Arial">Paste the following appropriate code where it says "RAM 
GOES HERE":</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber4">
  <tbody><tr>
    <td width="50%"><font face="Arial">6502 or 6809</font></td>
    <td width="50%"><font face="Arial">Z80</font></td>
  </tr>
  <tr>
    <td width="50%"><font face="Arial" color="#0000FF" size="2">sramAddress(15 downto 0) &lt;= 
cpuAddress(15 downto 0);<br>
    sramData &lt;= 
    cpuDataOut when n_WR='0' else (others =&gt; 'Z');<br>
    n_sRamWE &lt;= n_memWR;<br>
    n_sRamOE &lt;= n_memRD;<br>
    n_sRamCS &lt;= n_externalRamCS;</font></td>
    <td width="50%"><font face="Arial" color="#0000FF" size="2">sramAddress(15 downto 0) &lt;= 
cpuAddress(15 downto 0);<br>
    sramData &lt;= 
    cpuDataOut when n_memWR='0' else (others =&gt; 'Z'); <br>
    n_sRamWE &lt;= n_memWR or  n_externalRamCS;<br>
    n_sRamOE &lt;= n_memRD or  n_externalRamCS;<br>
    n_sRamCS &lt;= n_externalRamCS;</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">Note that the sramData bus is bidirectional and only 
outputs data when write is active (n_WR='0') otherwise it is set to an input so 
that the CPU can read from it ( ie. (others =&gt; 'Z' ) ).</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4"><a name="Interfaces"></a>Interfaces</font></b></p>

<p><font face="Arial">I have deliberately designed the TV/monitor and keyboard 
interface to appear to the host software as if it was a 6850 serial port (write 
sends to the display, read gets the keyboard data, status request determines if 
the receive (key pressed) or send (display) is ready). As a result, these 
components are completely interchangeable which makes this design very flexible. 
The BASIC is already set up to use a 6850 ACIA compatible serial port so the 
monitor/keyboard can replace the serial port with NO SOFTWARE CHANGE.</font></p>

<p><font face="Arial">Using the current configuration and pinout assignments you 
can have:<br>
&nbsp;&nbsp;&nbsp; 1 Serial port<br>
&nbsp;&nbsp;&nbsp; 2 Serial ports<br>
&nbsp;&nbsp;&nbsp; 1 TV/monitor and PS2 keyboard<br>
&nbsp;&nbsp;&nbsp; 1 TV/monitor and PS2 keyboard plus 1 serial port<br>
<i>&nbsp;&nbsp;&nbsp; other: there are several spare pins on the FPGA so several 
more serial ports are easily possible if needed</i></font></p>

<p><font face="Arial">Decide on whether a serial port or monitor/keyboard is to 
be used and copy one of the following into the code where it says "INPUT/OUTPUT 
DEVICES GO HERE"</font></p>

<p><font face="Arial">If you are to use two I/O devices (eg. two serial or one 
serial and one TV/keyboard) then repeat the below process, but for the second 
device, changing "io1" to "io2", "interface1DataOut" to "interface2DataOut", "rxd =&gt; rxd1" to "rxd 
=&gt; rxd2", "txd =&gt; txd1" to "txd =&gt; txd2" etc. NOTE: ONLY ONE MONITOR/KB INTERFACE 
CAN BE SUPPORTED WITH THIS BOARD. However, you can have several serial 
interfaces of one monitor/keyboard with additional serial interfaces.</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial"><a name="SerialInterface"></a>Using a serial port (connected to a PC) as the output and 
input</font></b></p>

<p><font face="Arial">The following definition needs to be copied and pasted 
(pick the one appropriate to the processor being used).</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber1">
  <tbody><tr>
    <td width="50%"><font face="Arial">6502 or 6809</font></td>
    <td width="50%"><font face="Arial">Z80</font></td>
  </tr>
  <tr>
    <td width="50%"><font face="Arial" size="2" color="#0000FF">io1 : entity 
    work.bufferedUART<br>
    port map(<br>
    clk =&gt; clk,<br>
    n_wr =&gt; n_interface1CS or cpuClock or n_WR,<br>
    n_rd =&gt; n_interface1CS or cpuClock or (not n_WR),<br>
    n_int =&gt; n_int1,<br>
    regSel =&gt; cpuAddress(0),<br>
    dataIn =&gt; cpuDataOut,<br>
    dataOut =&gt; interface1DataOut,<br>
    rxClock =&gt; serialClock,<br>
    txClock =&gt; serialClock,<br>
    rxd =&gt; rxd1,<br>
    txd =&gt; txd1,<br>
    n_cts =&gt; '0',<br>
    n_dcd =&gt; '0',<br>
    n_rts =&gt; rts1<br>
    );</font></td>
    <td width="50%"><font face="Arial" size="2" color="#0000FF">io1 : entity 
    work.bufferedUART<br>
    port map(<br>
    clk =&gt; clk,<br>
    n_wr =&gt; n_interface1CS or n_ioWR,<br>
    n_rd =&gt; n_interface1CS or n_ioRD,<br>
    n_int =&gt; n_int1,<br>
    regSel =&gt; cpuAddress(0),<br>
    dataIn =&gt; cpuDataOut,<br>
    dataOut =&gt; interface1DataOut,<br>
    rxClock =&gt; serialClock,<br>
    txClock =&gt; serialClock,<br>
    rxd =&gt; rxd1,<br>
    txd =&gt; txd1,<br>
    n_cts =&gt; '0',<br>
    n_dcd =&gt; '0',<br>
    n_rts =&gt; rts1<br>
    );</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">The "not read" and "not write" require slightly different 
connections when using the Z80, as can be seen above due to it appearing in 
"memory space" on the 6502 or 6809 architecture but appears in "IO space" in the 
Z80 architecture.</font></p>

<p><font face="Arial">Data in connects to the CPU data out, same as for other 
memory/devices in this machine.</font></p>

<p><font face="Arial">The data output is shown connected to the "interface1DataOut" 
(or "interface1DataOut" for the second instance if used) 
lines - this consists of 8 connections and will be connected to the CPU data 
input only when the interface is being accessed (only one set of outputs can go to any 
input at the same time) ie. "connect the interface1DataOut to the cpu data input if the 
interface1 is selected". That process is handled by the "bus isolation" lower on this 
page.</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial"><a name="TVKeyboardInterface"></a>Using a TV/monitor and a PS2 keyboard as the output and 
input.</font></b></p>

<p><font face="Arial">
<img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/PALDisplayPic.jpg" width="600" height="450"><br>
<font size="2">(This board running on a standard PAL television, full colour 
mode, 80x25 characters)</font></font></p>

<p><font face="Arial">I have designed the TV display to be configurable to just 
about whatever you require of it. The "default" configuration is 80x25 chars on 
a standard VGA (640x480) display. This utilises 25 of the 30 lines in this mode, 
centred on the display. This, however, can be changed.</font></p>

<p><font face="Arial">Video format options : </font></p>

<p><font face="Arial">VGA timings (various modes) - 640x480, 60Hz default<br>
PAL (50Hz) timings<br>
NTSC (50Hz) timings</font></p>

<p><font face="Arial">RGB 16 colour output (with single colour on composite 
video pin if needed)<br>
Composite black and white output (with single colour also on RGB pins if needed)</font></p>

<p><font face="Arial">To add a monitor/keyboard into the design, the following 
needs to be included:</font></p>

<p><font face="Arial">Note the different connections for Z80 or 6502/6809. 
Comment/delete the 6502 lines and uncomment the Z80 lines if using a Z80.<br>
If RGB or monochrome signals are not to be used then those lines not required 
are to be deleted.</font></p>

<p><font face="Arial">The following definition needs to be copied and pasted.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber1">
  <tbody><tr>
    <td width="50%"><font face="Arial">6502 or 6809</font></td>
    <td width="50%"><font face="Arial">Z80</font></td>
  </tr>
  <tr>
    <td width="50%"><font face="Arial" color="#0000FF" size="2">io1 : entity work.SBCTextDisplayRGB<br>
port map (<br>
n_reset =&gt; n_reset,<br>
clk =&gt; clk,<br>
<br>
-- RGB video signals<br>
hSync =&gt; hSync,<br>
vSync =&gt; vSync,<br>
videoR0 =&gt; videoR0,<br>
videoR1 =&gt; videoR1,<br>
videoG0 =&gt; videoG0,<br>
videoG1 =&gt; videoG1,<br>
videoB0 =&gt; videoB0,<br>
videoB1 =&gt; videoB1,<br>
<br>
-- Monochrome video signals (when using TV timings only)<br>
sync =&gt; videoSync,<br>
video =&gt; video,<br>
<br>
n_wr =&gt; n_interface1CS or cpuClock or n_WR,<br>
n_rd =&gt; n_interface1CS or cpuClock or (not n_WR),<br>
n_int =&gt; n_int1,<br>
regSel =&gt; cpuAddress(0),<br>
dataIn =&gt; cpuDataOut,<br>
dataOut =&gt; interface1DataOut,<br>
ps2Clk =&gt; ps2Clk,<br>
ps2Data =&gt; ps2Data<br>
);</font></td>
    <td width="50%"><font face="Arial" color="#0000FF" size="2">io1 : entity work.SBCTextDisplayRGB<br>
port map (<br>
n_reset =&gt; n_reset,<br>
clk =&gt; clk,<br>
<br>
-- RGB video signals<br>
hSync =&gt; hSync,<br>
vSync =&gt; vSync,<br>
videoR0 =&gt; videoR0,<br>
videoR1 =&gt; videoR1,<br>
videoG0 =&gt; videoG0,<br>
videoG1 =&gt; videoG1,<br>
videoB0 =&gt; videoB0,<br>
videoB1 =&gt; videoB1,<br>
<br>
-- Monochrome video signals (when using TV timings only)<br>
sync =&gt; videoSync,<br>
video =&gt; video,<br>
<br>
    n_wr =&gt; n_interface1CS or n_ioWR,<br>
    n_rd =&gt; n_interface1CS or n_ioRD,<br>
n_int =&gt; n_int1,<br>
regSel =&gt; cpuAddress(0),<br>
dataIn =&gt; cpuDataOut,<br>
dataOut =&gt; interface1DataOut,<br>
ps2Clk =&gt; ps2Clk,<br>
ps2Data =&gt; ps2Data<br>
);</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">This is for the default 80x25 chars on a standard VGA 
(640x480) display. The relevant options within the display/keyboard component 
are available to be changed, however. These are done by "overriding" the values 
internally and are done as shown below. Here are some options that you are 
likely to use. These are, however, fully configurable and you can create a 
display with whatever format you want.</font></p>

<p><font face="Arial">Here are some other options (additional code that needs to 
be added to the above code is shown in <font color="#FF0000" size="2"><b>bold 
red</b></font>). Note - NO semi-colon before or after the generic map block:</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="1000" id="AutoNumber15">
  <tbody><tr>
    <td width="512" bgcolor="#C0C0C0"><font face="Arial">DESCRIPTION</font></td>
    <td width="485" bgcolor="#C0C0C0"><font face="Arial">ADDITIONAL CODE NEEDED</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">68 characters per line, 30 lines on a 
    standard VGA display requires each character to be stretched horizontally (3 
    clocks per pixel instead of 2), the vertical characters increased, the 
    characters per line changed and also the top scanline where the display is to start. To achieve 
this, include the "default" display component then override (change) some of the 
parameters to match what is now needed. This is done by adding the override 
values as shown in bold below (remaining code is same as above). This is what 
makes the display so configurable.</font><p><font face="Arial"><font size="2">
    <i>I</i></font><i><font size="2">nternal memory used: 2K Display RAM, 2K 
    Attribute RAM, 1K Character ROM = 5K total. The ROM takes a further 8K, so 
    no remaining internal memory. Program memory must therefore use external 
    SRAM.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
HORIZ_CHARS =&gt; 68,<br>
CLOCKS_PER_PIXEL =&gt; 2,<br>
VERT_CHARS =&gt; 30,<br>
DISPLAY_TOP_SCANLINE =&gt; 35<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">PAL colour display 80x25 chars centred on screen</font><p><font face="Arial">
    <font size="2"><i>I</i></font><i><font size="2">nternal memory used: 2K 
    Display RAM, 2K Attribute RAM, 1K Character ROM = 5K total. The ROM takes a 
    further 8K, so no remaining internal memory. Program memory must therefore 
    use external SRAM.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
CLOCKS_PER_PIXEL =&gt; 3,<br>
CLOCKS_PER_SCANLINE =&gt; 3200,<br>
DISPLAY_TOP_SCANLINE =&gt; 65,<br>
VERT_SCANLINES =&gt; 312,<br>
VERT_PIXEL_SCANLINES =&gt; 1,<br>
VSYNC_SCANLINES =&gt; 4,<br>
HSYNC_CLOCKS =&gt; 235,<br>
DISPLAY_LEFT_CLOCK =&gt; 850<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">PAL colour display 40x25 chars centred on screen</font><p><font face="Arial">
    <font size="2"><i>I</i></font><i><font size="2">nternal memory used: 1K 
    Display RAM, 1K Attribute RAM, 1K Character ROM = 3K total. The ROM takes a 
    further 8K, so there is 2K spare internal memory. Therefore a full colour 
    40x25 computer with 2K program space is available within the FPGA without 
    needing an external SRAM chip.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
</b></font><b><font face="Arial" size="2" color="#FF0000">HORIZ_CHARS =&gt; 40,</font></b><font face="Arial" color="#FF0000" size="2"><b><br>
CLOCKS_PER_PIXEL =&gt; 6,<br>
CLOCKS_PER_SCANLINE =&gt; 3200,<br>
DISPLAY_TOP_SCANLINE =&gt; 65,<br>
VERT_SCANLINES =&gt; 312,<br>
VERT_PIXEL_SCANLINES =&gt; 1,<br>
VSYNC_SCANLINES =&gt; 4,<br>
HSYNC_CLOCKS =&gt; 235,<br>
DISPLAY_LEFT_CLOCK =&gt; 850<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">NTSC colour display 80x25 chars centred on screen</font><p><font face="Arial">
    <font size="2"><i>I</i></font><i><font size="2">nternal memory used: 2K 
    Display RAM, 2K Attribute RAM, 1K Character ROM = 5K total. The ROM takes a 
    further 8K, so no remaining internal memory. Program memory must therefore 
    use external SRAM.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
CLOCKS_PER_PIXEL =&gt; 3,<br>
CLOCKS_PER_SCANLINE =&gt; 3200,<br>
DISPLAY_TOP_SCANLINE =&gt; 37,<br>
VERT_SCANLINES =&gt; 262,<br>
VERT_PIXEL_SCANLINES =&gt; 1,<br>
VSYNC_SCANLINES =&gt; 4,<br>
HSYNC_CLOCKS =&gt; 235,<br>
DISPLAY_LEFT_CLOCK =&gt; 850<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">NTSC colour display 40x25 chars centred 
    on screen</font><p><font face="Arial"><font size="2"><i>I</i></font><i><font size="2">nternal 
    memory used: 1K Display RAM, 1K Attribute RAM, 1K Character ROM = 3K total. 
    The ROM takes a further 8K, so there is 2K spare internal memory. Therefore 
    a full colour 40x25 computer with 2K program space is available within the 
    FPGA without needing an external SRAM chip.</font></i></font></p>
    <p>&nbsp;</p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
    </b></font><b><font face="Arial" size="2" color="#FF0000">HORIZ_CHARS =&gt; 40,</font></b><font face="Arial" color="#FF0000" size="2"><b><br>
CLOCKS_PER_PIXEL =&gt; 6,<br>
CLOCKS_PER_SCANLINE =&gt; 3200,<br>
DISPLAY_TOP_SCANLINE =&gt; 37,<br>
VERT_SCANLINES =&gt; 262,<br>
VERT_PIXEL_SCANLINES =&gt; 1,<br>
VSYNC_SCANLINES =&gt; 4,<br>
HSYNC_CLOCKS =&gt; 235,<br>
DISPLAY_LEFT_CLOCK =&gt; 850<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">VGA Monitor, 40x25 chars</font><p><font face="Arial">
    <font size="2"><i>I</i></font><i><font size="2">nternal memory used: 1K 
    Display RAM, 1K Attribute RAM, 1K Character ROM = 3K total. The ROM takes a 
    further 8K, so there is 2K spare internal memory. Therefore a computer with 
    full colour VGA monitor compatible 40x25 display and 2K program space is 
    available within the FPGA without needing an external SRAM chip.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
    </b></font><b><font face="Arial" size="2" color="#FF0000">HORIZ_CHARS =&gt; 40,</font></b><font face="Arial" color="#FF0000" size="2"><b><br>
CLOCKS_PER_PIXEL =&gt; 4<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
  <tr>
    <td width="512"><font face="Arial">VGA Monitor, 80x25 chars running at 
    640x400 resolution</font><p><font face="Arial">
    <font size="2"><i>Same format as for the default VGA display but in a 
    different VGA mode so that the complete screen is used (larger characters).<br>
    I</i></font><i><font size="2">nternal memory used: 2K 
    Display RAM, 2K Attribute RAM, 1K Character ROM = 5K total. The ROM takes a 
    further 8K, so no remaining internal memory. Program memory must therefore 
    use external SRAM.</font></i></font></p></td>
    <td width="485"><font face="Arial" color="#0000FF" size="2">&nbsp; :<br>
io1 : entity work.SBCTextDisplayRGB<br>
    </font><font face="Arial" color="#FF0000" size="2">
<b>generic map(<br>
    DISPLAY_TOP_SCANLINE =&gt; 35,<br>
    VERT_SCANLINES =&gt; 448,<br>
    V_SYNC_ACTIVE =&gt; '1'<br>
)</b></font><font face="Arial" color="#0000FF" size="2"><br>
port map (<br>
n_reset =&gt; n_reset,<br>
&nbsp;
:</font></td>
  </tr>
</tbody></table>

<p>&nbsp;</p>

<p><font face="Arial">The complete set of parameters that can be altered are at 
the top of the display VHDL and shown here (values are for the default 640x480 
VGA, 80x25 chars):</font></p>

<p><font face="Arial" size="2" color="#0000FF">constant EXTENDED_CHARSET : 
integer := 0; -- 1 = 256 chars, 0 = 128 chars<br>
constant COLOUR_ATTS_ENABLED : integer := 1; -- 1=Colour for each character, 
0=Colour applied to whole display<br>
-- VGA 640x480 Default values<br>
constant VERT_CHARS : integer := 25;<br>
constant HORIZ_CHARS : integer := 80;<br>
constant CLOCKS_PER_SCANLINE : integer := 1600; -- NTSC/PAL = 3200<br>
constant DISPLAY_TOP_SCANLINE : integer := 35+40;<br>
constant DISPLAY_LEFT_CLOCK : integer := 288; -- NTSC/PAL = 600+<br>
constant VERT_SCANLINES : integer := 525; -- NTSC=262, PAL=312<br>
constant VSYNC_SCANLINES : integer := 2; -- NTSC/PAL = 4<br>
constant HSYNC_CLOCKS : integer := 192; -- NTSC/PAL = 235<br>
constant VERT_PIXEL_SCANLINES : integer := 2;<br>
constant CLOCKS_PER_PIXEL : integer := 2; -- min = 2<br>
constant H_SYNC_ACTIVE : std_logic := '0';<br>
constant V_SYNC_ACTIVE : std_logic := '0';<br>
constant DEFAULT_ATT : std_logic_vector(7 downto 0) := "00001111" -- background 
iBGR | foreground iBGR (i=intensity)<br>
constant ANSI_DEFAULT_ATT : std_logic_vector(7 downto 0) := "00000111" -- 
background iBGR | foreground iBGR (i=intensity)</font></p>

<p><font face="Arial"><b><a name="SDCard"></a>SD Card</b></font></p>

<p><font face="Arial">Coming soon (all working, just not published yet)</font></p>

<p><font face="Arial">To include the SD card interface, copy and paste the 
following to the same place as the serial or monitor/keyboard above.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber1">
  <tbody><tr>
    <td width="50%"><font face="Arial">6502 or 6809</font></td>
    <td width="50%"><font face="Arial">Z80</font></td>
  </tr>
  <tr>
    <td width="50%"><font face="Arial" size="2" color="#0000FF">sd1 : entity 
    work.sd_controller <br>
    port map(<br>
    sdCS =&gt; sdCS,<br>
    sdMOSI =&gt; sdMOSI,<br>
    sdMISO =&gt; sdMISO,<br>
    sdSCLK =&gt; sdSCLK,<br>
n_wr =&gt;  n_sdCardCS or cpuClock or n_WR,<br>
n_rd =&gt;  n_sdCardCS or cpuClock or (not n_WR),<br>
    n_reset =&gt; n_reset,<br>
    dataIn =&gt; cpuDataOut,<br>
    dataOut =&gt; sdCardDataOut,<br>
    regAddr =&gt; cpuAddress(2 downto 0),<br>
    driveLED =&gt; driveLED,<br>
    clk =&gt; sdClock -- twice the spi clk<br>
    );</font></td>
    <td width="50%"><font face="Arial" size="2" color="#0000FF">sd1 : entity 
    work.sd_controller <br>
    port map(<br>
    sdCS =&gt; sdCS,<br>
    sdMOSI =&gt; sdMOSI,<br>
    sdMISO =&gt; sdMISO,<br>
    sdSCLK =&gt; sdSCLK,<br>
    n_wr =&gt; n_sdCardCS or n_ioWR,<br>
    n_rd =&gt; n_sdCardCS or n_ioRD,<br>
    n_reset =&gt; n_reset,<br>
    dataIn =&gt; cpuDataOut,<br>
    dataOut =&gt; sdCardDataOut,<br>
    regAddr =&gt; cpuAddress(2 downto 0),<br>
    driveLED =&gt; driveLED,<br>
    clk =&gt; sdClock -- twice the spi clk<br>
    );</font></td>
  </tr>
</tbody></table>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4"><a name="ReadWriteSignals"></a>Memory 
read/write signals</font></b></p>

<p><font face="Arial">The memory read logic is the same for the 6502 or 6809. 
However, the Z80 uses different signals as it is able to address IO and memory 
space separately. As a result, the memory read and memory write signals are 
defined differently.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber5">
  <tbody><tr>
    <td width="50%"><font face="Arial">6502 or 6809</font></td>
    <td width="50%"><font face="Arial">Z80</font></td>
  </tr>
  <tr>
    <td width="50%"><font size="2" color="#0000FF" face="Arial">n_memRD &lt;= 
    not(cpuClock) nand n_WR;<br>
    n_memWR &lt;= not(cpuClock) nand (not n_WR);</font></td>
    <td width="50%"><font face="Arial" size="2" color="#0000FF">n_ioWR &lt;= n_WR 
    or n_IORQ;<br>
    n_memWR &lt;= n_WR or n_MREQ;<br>
    n_ioRD &lt;= n_RD or n_IORQ;<br>
    n_memRD &lt;= n_RD or n_MREQ;</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">Paste the appropriate lines where it says "MEMORY 
READ/WRITE LOGIC GOES HERE"</font></p>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4"><a name="ChipSelects"></a>Chip selects</font></b></p>

<p><font face="Arial">Each piece of memory or peripheral needs to be addressed 
at a fixed location within the CPU's 64KByte memory map.</font></p>

<p><font face="Arial">The 6809 and 6502 designs has the ROM appearing at the top 
of the memory space (because CPU execution reads the top few bytes of the memory 
to determine where to start, so ROM is needed at the top).</font></p>

<p><font face="Arial">The Z80, on the other hand, always starts execution at 
location $0000, so for the Z80 system the ROM is placed at the bottom of memory.</font></p>

<p><font face="Arial">The Z80 has separate addressing for I/O peripherals which 
doesn't interfere with memory addressing. The 6502 and 6809 don't have this, so 
peripherals need to appear within the memory space.</font></p>

<p><font face="Arial">Here is the memory map that is used (you can change if 
needed by altering the BASIC ROM code)</font></p>

<p><font face="Arial">
<img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/MulticompMemoryMap.jpg" width="800" height="789"></font></p>

<p><font face="Arial">The BASIC ROMs that have been provided have free space in 
the 6809 ROM between $FF85 and $FFE9. The 6502 ROM has unused space between 
$FF77 and $FFF9. So, to achieve as much commonality as possible between the 
systems, address $FFD0/$FFD1 is chosen to be the address where the first serial 
interface (or TV/Keyboard) will be addressed and $FFD2/$FFD3 will be the pairing 
chosen for the second (if used).</font></p>

<p><font face="Arial">Within the Z80 architecture, IO address $80 and $81 is 
used for the first interface and $82 and $83 is used for the second, if fitted.</font></p>

<p><font face="Arial">Address decoding for the RAM is described in the following 
table. Yellow cells are connected to the RAM. "x" cells are decoding "don't 
care" values. </font></p>

<p><font face="Arial">For the 6502 and 6809 the RAM starts at zero so the 
address decoding is straightforward ie. all remaining bits not used by RAM must 
be zero to select it.</font></p>

<p><font face="Arial">For the Z80 it is slightly more complex because of the 8K 
($2000) offset. This is straightforward from RAM up to 8K as they all fit in the 
second 8K block in the memory map (ie. A15..A13 = "001"). The problem occurs 
with the 32K external RAM option. To resolve this, the 32K memory is regarded as 
four 8K memory blocks, so each has a particular A15...A13 pattern. This is shown 
below. <i>Note, for the 32K memory for the Z80, A14 and A13 are used for both 
decoding and for internal addressing, which at first sight appears to break the 
rule where decode uses lines not used internally. However, this is correct and 
works properly.</i></font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="1100" id="AutoNumber7">
  <tbody><tr>
    <td width="5%" align="center">&nbsp;</td>
    <td width="5%" align="center"><b><font face="Arial" size="2">Start addr</font></b></td>
    <td width="5%" align="center"><b><font face="Arial" size="2">End addr</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A15</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A14</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A13</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A12</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A11</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A10</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A9</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A8</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A7</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A6</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A5</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A4</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A3</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A2</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A1</font></b></td>
    <td width="4%" align="center"><b><font face="Arial" size="2">A0</font></b></td>
  </tr>
  <tr>
    <td width="5%" align="center" bgcolor="#C0C0C0"><b>
    <font face="Arial" size="2">6809 or 6502</font></b></td>
    <td width="5%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="5%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">1K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">0000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">03FF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">2K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">0000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">07FF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">4K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">0000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">0FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">8K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">0000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">1FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">32K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">0000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">7FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center" bgcolor="#C0C0C0"><b>
    <font face="Arial" size="2">Z80</font></b></td>
    <td width="5%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="5%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
    <td width="4%" align="center" bgcolor="#C0C0C0">&nbsp;</td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">1K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">2000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">23FF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">1</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">2K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">2000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">27FF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">1</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">4K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">2000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">2FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">1</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">8K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">2000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">3FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center"><b><font face="Arial" size="2">32K</font></b></td>
    <td width="5%" align="center"><font face="Arial" size="2">2000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">3FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center">&nbsp;</td>
    <td width="5%" align="center"><font face="Arial" size="2">4000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">5FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center">&nbsp;</td>
    <td width="5%" align="center"><font face="Arial" size="2">6000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">7FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
  <tr>
    <td width="5%" align="center">&nbsp;</td>
    <td width="5%" align="center"><font face="Arial" size="2">8000</font></td>
    <td width="5%" align="center"><font face="Arial" size="2">9FFF</font></td>
    <td width="4%" align="center"><font face="Arial" size="2">1</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    0</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
    <td width="4%" align="center" bgcolor="#FFFF99"><font face="Arial" size="2">
    x</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">If MAXIMUM external RAM then the RAM will occupy all 
addresses not taken by the ROM, so the address decode is simply "not ROM".</font></p>

<p><b><font face="Arial">For the 6502 or 6809 processors</font></b></p>

<p><font face="Arial">Chip select code is</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber11">
  <tbody><tr>
    <td width="100%"><font face="Arial" color="#0000FF" size="2">n_basRomCS &lt;= '0' when 
cpuAddress(15 downto 13) = "111" else '1'; --8K at top of memory<br>
n_interface1CS &lt;= '0' when cpuAddress(15 downto 1) = "111111111101000" else '1'; -- 2 
bytes FFD0-FFD1<br>
n_interface2CS &lt;= '0' when cpuAddress(15 downto 1) = "111111111101001" else '1'; -- 2 
bytes FFD2-FFD3<br>
n_sdCardCS &lt;= '0' when cpuAddress(15 downto 3) = "1111111111011" else '1'; -- 
8 
bytes FFD8-FFDF</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">If the second interface is NOT being used then there is no 
need to 
include the line that starts "n_interface2CS &lt;=". Similarly for the 
n_sdCardCS.</font></p>

<p><font face="Arial">Then one of the following lines...</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber8">
  <tbody><tr>
    <td width="175"><font face="Arial">1K internal RAM</font></td>
    <td width="622"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 10) = "000000" else '1';</font></td>
  </tr>
  <tr>
    <td width="175"><font face="Arial">2K internal RAM</font></td>
    <td width="622"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 11) = "00000" else '1';</font></td>
  </tr>
  <tr>
    <td width="175"><font face="Arial">4K internal RAM</font></td>
    <td width="622"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 12) = "0000" else '1';</font></td>
  </tr>
  <tr>
    <td width="175"><font face="Arial">8K external SRAM</font></td>
    <td width="622"><font face="Arial" color="#0000FF" size="2">n_externalRamCS 
    &lt;= '0' when cpuAddress(15 downto 13) = "000" else '1';</font></td>
  </tr>
  <tr>
    <td width="175"><font face="Arial">32K external SRAM</font></td>
    <td width="622"><font face="Arial" color="#0000FF" size="2">n_externalRamCS 
    &lt;= '0' when cpuAddress(15) = '0' else '1';</font></td>
  </tr>
  <tr>
    <td width="175"><font face="Arial">Full external SRAM</font></td>
    <td width="622"><font face="Arial" color="#0000FF" size="2">n_externalRamCS&lt;= not n_basRomCS;</font></td>
  </tr>
</tbody></table>

<p><b><font face="Arial">For the Z80 processor</font></b></p>

<p><font face="Arial">Chip select code is</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber12">
  <tbody><tr>
    <td width="100%"><font face="Arial" size="2" color="#0000FF">n_basRomCS &lt;= '0' when 
cpuAddress(15 downto 13) = "000" else '1'; --8K at bottom of memory<br>
n_interface1CS &lt;= '0' when cpuAddress(7 downto 1) = "1000000" and (n_ioWR='0' or 
n_ioRD = '0') else '1'; -- 2 Bytes $80-$81<br>
n_interface2CS &lt;= '0' when cpuAddress(7 downto 1) = "1000001" and (n_ioWR='0' or 
n_ioRD = '0') else '1'; -- 2 Bytes $82-$83<br>
n_sdCardCS &lt;= '0' when cpuAddress(7 downto 3) = "10001" and (n_ioWR='0' or 
n_ioRD = '0') else '1'; -- 8 Bytes $88-$8F</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">If the second interface is NOT being used then there is no 
need to 
include the line that starts "n_interface2CS &lt;=". Similarly for the 
n_sdCardCS.</font></p>

<p><font face="Arial">Then one of the following lines...</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber9">
  <tbody><tr>
    <td width="180"><font face="Arial">1K internal RAM</font></td>
    <td width="617"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 10) = "001000" else '1';</font></td>
  </tr>
  <tr>
    <td width="180"><font face="Arial">2K internal RAM</font></td>
    <td width="617"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 11) = "00100" else '1';</font></td>
  </tr>
  <tr>
    <td width="180"><font face="Arial">4K internal RAM</font></td>
    <td width="617"><font color="#0000FF" face="Arial" size="2">n_internalRam1CS 
    &lt;= '0' when cpuAddress(15 downto 12) = "0010" else '1';</font></td>
  </tr>
  <tr>
    <td width="180"><font face="Arial">8K external SRAM</font></td>
    <td width="617"><font face="Arial" color="#0000FF" size="2">n_externalRamCS 
    &lt;= '0' when cpuAddress(15 downto 13) = "001" else '1';</font></td>
  </tr>
  <tr>
    <td width="180"><font face="Arial">32K external SRAM</font></td>
    <td width="617"><font face="Arial" color="#0000FF" size="2">n_externalRamCS 
    &lt;= '0' when cpuAddress(15 downto 13) = "001" or cpuAddress(15 downto 13) = 
    "010" or cpuAddress(15 downto 13) = "011" or cpuAddress(15 downto 13) = 
    "100" else '1';</font></td>
  </tr>
  <tr>
    <td width="180"><font face="Arial">Full external SRAM</font></td>
    <td width="617"><font face="Arial" color="#0000FF" size="2">n_externalRamCS&lt;= not n_basRomCS;</font></td>
  </tr>
</tbody></table>

<p>&nbsp;</p>

<p><font face="Arial">Paste the appropriate code to where it says "CHIP SELECTS 
GO HERE"</font></p>

<p>&nbsp;</p>

<p><i><font face="Arial" size="2">If a particular peripheral or memory chip is to appear in 
a specific place in the memory map, it needs to be "fully decoded". It is very 
common in small computers for chips to only be "partially decoded", mainly due 
to the fact that full decoding needs more logic chips on the board. Using FPGA 
however, full decoding can be done without any additional components.</font></i></p>

<p><i><font face="Arial" size="2">So, for example, the SD card interface needs 3 address 
lines (therefore 8 internal addresses - 2^3=8) to access the internal features 
of the chip then these would normally be connected to the lowest 3 address lines 
of the address bus so that the 8 internal addresses would appear consecutively 
in the memory address space. Full memory decoding then needs ALL the remaining 
address lines not connected to the chip to go to the chip selection logic.<br>
In this example the address for this chip is<br>
SSSS SSSS SSSS SCCC where S is a select address bit ant C is a chip internal 
address. All the "S" bits need to be assigned to a particular value.<br>
if we pick "1111 1111 1101 1" as the address chip select bits then that 
particular chip would appear at "FFD8" (1111 1111 1101 1<font color="#FF0000"><b>000</b></font>) 
to "FFDF" (1111 1111 1101 1<b><font color="#FF0000">111</font></b>) in the 
memory map.</font></i></p>

<p><i><font face="Arial" size="2">Similarly, all other memory and peripherals are also fully 
decoded - the more internal addresses used in the chip, the fewer are used for 
the "chip selects", therefore different number of bits are used in the above 
equations.</font></i></p>

<p>&nbsp;</p>

<p><b><font face="Arial" size="4"><a name="BusIsolation"></a>Bus isolation</font></b></p>
<p><font face="Arial">For the CPU incoming (read) data bus is shared by all 
peripherals, so VHDL glue logic is needed to ensure only one peripheral presents 
the data onto the bus at any time. Each peripheral has it's own data out bus, so 
depending on the chip selects, the appropriate data is connected to the CPU in 
bus.</font></p>

<p><font face="Arial">Note: For the 6502 or 6809, because the interface memory map is "stealing" some 
locations from the BASIC ROM, the interface data lines must appear before (in 
preference to) the BASIC rom data line.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber13">
  <tbody><tr>
    <td width="100%"><font face="Arial" color="#0000FF" size="2">cpuDataIn &lt;=<br>
interface1DataOut when n_interface1CS = '0' else<br>
interface2DataOut when n_interface2CS = '0' else<br>
sdCardDataOut when n_sdCardCS = '0' else<br>
basRomData when n_basRomCS = '0' else<br>
internalRam1DataOut when n_internalRam1CS= '0' else<br>
sramData when n_externalRamCS= '0' else<br>
x"FF";</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">Important notes (changes needed to the above code):<br>
1. If the second interface or SD card is not used then remove 
the "interface2DataOut" or "sdCardDataOut" lines of code as appropriate.<br>
2. You would have chosen whether internal RAM or external RAM is being used, so 
remove the internalRam1DataOut line if using external RAM, or remove the 
sramData line if using internal RAM.</font></p>

<p><font face="Arial">Paste the appropriate code to where it says "BUS ISOLATION 
GOES HERE".</font></p>

<p>&nbsp;</p>

<p><font face="Arial" size="4"><b><a name="Clocks"></a>The  clocks</b></font></p>

<p><font face="Arial">The CPU uses a simple divider to reduce the 50MHz incoming 
clock to the required CPU speed. Similarly, the 50MHz clock is divided by 50 to 
get the 1MHz SD card clock.</font></p>

<p><font face="Arial">For the serial, a slightly more complex divider is used 
and is based on the DDS (Direct digital synthesis) method of producing an 
arbitrary frequency using a 16 bit counter. This is MUCH better for the serial 
speeds because a greater accuracy (well within 1%) is easily achieved. The 
default value (2416) within the code has the serial clock set for 115200 baud. 
See the comments within the code for the other values.</font></p>

<p><font face="Arial">Basically, f = (increment x 50,000,000) / 65,536</font></p>

<p><font face="Arial">Where f is the baud rate x 16, as required for the ACIA to 
run properly.</font></p>

<p><font face="Arial">Paste the following code to where it says "SYSTEM CLOCKS 
GO HERE". The serial clock parts of the code can be removed if serial is not 
being used. Can remain, though.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber14">
  <tbody><tr>
    <td width="100%"><font face="Arial" color="#0000FF" size="2">-- SUB-CIRCUIT CLOCK SIGNALS <br>
serialClock &lt;= serialClkCount(15);<br>
process (clk)<br>
begin<br>
if rising_edge(clk) then<br>
<br>
</font><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 4 then
</b></font><b><font color="#808080" face="Arial" size="2">-- 4 = 10MHz, 3 = 
12.5MHz, 2=16.6MHz, 1=25MHz</font></b><font face="Arial" color="#0000FF" size="2"><br>
cpuClkCount &lt;= cpuClkCount + 1;<br>
else<br>
cpuClkCount &lt;= (others=&gt;'0');<br>
end if;<br>
</font><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 2 then
</b></font><b><font color="#808080" face="Arial" size="2">-- 2 when 10MHz, 2 
when 12.5MHz, 2 when 16.6MHz, 1 when 25MHz</font></b><font color="#FF0000" face="Arial" size="2"><b><br>
</b></font><font face="Arial" color="#0000FF" size="2">cpuClock &lt;= '0';<br>
else<br>
cpuClock &lt;= '1';<br>
end if; <br>
    <br>
    if sdClkCount &lt; 49 then -- 1MHz<br>
    sdClkCount &lt;= sdClkCount + 1;<br>
    else<br>
    sdClkCount &lt;= (others=&gt;'0');<br>
    end if;<br>
    if sdClkCount &lt; 25 then<br>
    sdClock &lt;= '0';<br>
    else<br>
    sdClock &lt;= '1';<br>
    end if;<br>
    <br>
-- Serial clock DDS<br>
-- 50MHz master input clock:<br>
-- Baud Increment<br>
-- 115200 2416<br>
-- 38400 805<br>
-- 19200 403<br>
-- 9600 201<br>
-- 4800 101<br>
-- 2400 50<br>
serialClkCount &lt;= serialClkCount + 2416;<br>
end if;<br>
end process;</font></td>
  </tr>
</tbody></table>

<p><font face="Arial">This code above sets the CPU frequency at 10MHz, which is 
much faster than what you would get if you built a computer using discrete 
components. You can control the frequency of the CPU by changing the upper 
counter check shown in red, above. If you make the change to the line in red, 
the one in green (the "half way" count) also needs changing. Here is a table of 
some of the values you could use.</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="800" id="AutoNumber10">
  <tbody><tr>
    <td width="33%"><font face="Arial">CPU frequency</font></td>
    <td width="33%"><font face="Arial">Counter top</font></td>
    <td width="34%"><font face="Arial">Counter half-way</font></td>
  </tr>
  <tr>
    <td width="33%"><font face="Arial">1MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    49 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    25 then</b></font></td>
  </tr>
  <tr>
    <td width="33%"><font face="Arial">2MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    24 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    12 then</b></font></td>
  </tr>
  <tr>
    <td width="33%"><font face="Arial">5MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    9 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    4 then</b></font></td>
  </tr>
  <tr>
    <td width="33%"><font face="Arial">10MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    4 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    2 then</b></font></td>
  </tr>
  <tr>
    <td width="33%" bgcolor="#FF8080"><font face="Arial">12.5MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    3 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    2 then</b></font></td>
  </tr>
  <tr>
    <td width="33%" bgcolor="#FF8080"><font face="Arial">16.6MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    2 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    2 then</b></font></td>
  </tr>
  <tr>
    <td width="33%" bgcolor="#FF8080"><font face="Arial">25MHz</font></td>
    <td width="33%"><font face="Arial" color="#FF0000" size="2"><b>if cpuClkCount &lt; 
    1 then</b></font></td>
    <td width="34%"><font face="Arial" color="#008000" size="2"><b>if cpuClkCount &lt; 
    1 then</b></font></td>
  </tr>
  <tr>
    <td width="33%">&nbsp;</td>
    <td width="33%">&nbsp;</td>
    <td width="34%">&nbsp;</td>
  </tr>
</tbody></table>
<p><font face="Arial">Note: high frequencies (in pink) work with internal RAM 
but are unlikely to work (particularly with the 6502 or 6809) with external SRAM 
unless the chip is fast and has short connections. If you try and the computer 
fails to respond properly then reduce the CPU frequency as shown above. Try it 
and see - no harm will come if you exceed the clock max.</font></p>
<p><font face="Arial">CPU frequency = 50,000,000 / (counter top+1) Hz</font></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><b><font face="Arial" size="4">Finished</font></b></p>
<p><font face="Arial">The VHDL is now complete !</font></p>
<p>&nbsp;</p>

<hr>

<p><b><font face="Arial" size="5"><a name="AssigningConnections"></a>Assigning 
the internal connections to actual pins on the FPGA</font></b></p>

<p><font face="Arial">If using the wiring that I show above, this has already 
been done for you.</font></p>

<p><font face="Arial">Open the "Microcomputer.qsf" file and you will see the 
assignments.</font></p>

<p><font face="Arial">The format of the assignment line is<br>
<font size="2" color="#0099FF"><b>set_location_assignment PIN_</b>pinNumber
<b>-to</b> vhdlSignalName</font></font></p>

<p><font face="Arial">Most (not all) pins support weak pull-ups, so the built-in 
switch on the board (connected to pin 144) has the pull-up turned on.</font></p>

<p><font face="Arial" size="2" color="#0099FF">set_instance_assignment -name 
WEAK_PULL_UP_RESISTOR ON -to n_reset</font></p>

<p>&nbsp;</p>

<hr>

<p><b><font face="Arial" size="5"><a name="BuildCompletion"></a>Build completion</font></b></p>

<p><font face="Arial">If you have completed the above steps then that completes the build of the microcomputer. It can 
now be compiled and uploaded to the FPGA.</font></p>

<p><font face="Arial">If you have wired up as shown in the diagram, once the 
upload is complete you will immediately (within a few tens of milliseconds) see 
the appropriate message appear on the monitor display or on the terminal 
connected to the board - whichever you chose to build.</font></p>

<p><font face="Arial">The computer is then ready to use!</font></p>

<hr>

<p><font face="Arial"><font size="5"><b><a name="ANSICodes"></a>ANSI</b></font><b><font size="5"> codes supported</font></b></font></p>

<p><font face="Arial">The TV/monitor display supports the following "escape" sequences</font></p>

<table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="1000" id="AutoNumber16">
  <tbody><tr>
    <td width="138" bgcolor="#C0C0C0"><font face="Arial">SEQUENCE</font></td>
    <td width="186" bgcolor="#C0C0C0"><font face="Arial">NAME</font></td>
    <td width="301" bgcolor="#C0C0C0"><font face="Arial">DESCRIPTION</font></td>
    <td width="370" bgcolor="#C0C0C0"><font face="Arial">EXAMPLE</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[H</font></td>
    <td width="186"><font face="Arial">Cursor Home</font></td>
    <td width="301"><font face="Arial">Moves the display cursor to top-left</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[H";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[K</font></td>
    <td width="186"><font face="Arial">Erase EOL</font></td>
    <td width="301"><font face="Arial">All characters on current line from cursor position to end 
    replaced with spaces</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[K";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[s</font></td>
    <td width="186"><font face="Arial">Save cursor pos</font></td>
    <td width="301"><font face="Arial">Current row and column saved</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[s";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[u</font></td>
    <td width="186"><font face="Arial">Restore cursor pos</font></td>
    <td width="301"><font face="Arial">Return cursor to previously stored row and column</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[u";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[2J</font></td>
    <td width="186"><font face="Arial">Clear screen</font></td>
    <td width="301"><font face="Arial">Same as PRINT CHR$(12) - clear screen and move cursor to top 
    left</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[2J";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[0J<br>
    <font size="2">or</font><br>
    ESC[J</font></td>
    <td width="186"><font face="Arial">Clear to end of screen</font></td>
    <td width="301"><font face="Arial">All positions from the current cursor to 
    end of screen are replaced with spaces</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[0J";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{val}A</font></td>
    <td width="186"><font face="Arial">Cursor up</font></td>
    <td width="301"><font face="Arial">Move cursor up {val} places</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[3A";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{val}B</font></td>
    <td width="186"><font face="Arial">Cursor down</font></td>
    <td width="301"><font face="Arial">Move cursor down {val} places</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[2B";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{val}C</font></td>
    <td width="186"><font face="Arial">Cursor forward</font></td>
    <td width="301"><font face="Arial">Move cursor right {val} places</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[15C";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{val}D</font></td>
    <td width="186"><font face="Arial">Cursor backward</font></td>
    <td width="301"><font face="Arial">Move cursor left {val} places</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[1D";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{row};{col}H</font></td>
    <td width="186"><font face="Arial">Set cursor position</font></td>
    <td width="301"><font face="Arial">Move the cursor to row {row} and column {col} (1;1=top left)</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[5;33H";</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[L<br>
    <i><font size="2">Only ONE line supported</font></i></font></td>
    <td width="186"><font face="Arial">Delete line</font></td>
    <td width="301"><font face="Arial">Delete the current cursor line and move 
    the display underneath it up one line. Last line of the display then is 
    blank.</font></td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[L"</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[M<br>
    <i><font size="2">Only ONE line supported</font></i></font></td>
    <td width="186"><font face="Arial">Insert line</font></td>
    <td width="301"><font face="Arial">Insert a blank line at the current cursor 
    position and move the display below it down one line.</font></td>
    <td width="370"><font face="Arial">
    PRINT CHR$(27);"[M"</font></td>
  </tr>
  <tr>
    <td width="138"><font face="Arial">ESC[{val}m<br>
    ESC[{val1};...<br>
    {val8}m<br>
    <br>
    <i><font size="2">(1 to 4 values)</font></i></font></td>
    <td width="186"><font face="Arial">Set graphics rendition<br>
    <br>
    Note: Text and background setting reversed if inverse is active.</font></td>
    <td width="301"><font face="Arial">Set the active foreground or background text colour. If 
    character attributes enabled, all characters that appear after this sequence 
    will use the colour specified. If character attributes disabled then the 
    complete screen will be displayed in the colours specified.</font><p>
    <font face="Arial">One or two 
    parameters can be specified in the same command.</font></p>
    <table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber17">
      <tbody><tr>
        <td width="16%"><font face="Arial">val</font></td>
        <td width="84%"><font face="Arial">effect</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">0</font></td>
        <td width="84%"><font face="Arial">Reset atts to default</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">1</font></td>
        <td width="84%"><font face="Arial">Bold (bright) text on</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">7</font></td>
        <td width="84%"><font face="Arial">Inverse colours (back&lt;=&gt;text)</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">22</font></td>
        <td width="84%"><font face="Arial">Bold (bright) text off</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">27</font></td>
        <td width="84%"><font face="Arial">Normal colours</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">30</font></td>
        <td width="84%"><font face="Arial">Text BLACK</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">31</font></td>
        <td width="84%"><font face="Arial">Text <font color="#AF0000">RED</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">32</font></td>
        <td width="84%"><font face="Arial">Text <font color="#00AF00">GREEN</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">33</font></td>
        <td width="84%"><font face="Arial">Text <font color="#AFAF00">YELLOW</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">34</font></td>
        <td width="84%"><font face="Arial">Text <font color="#0000AF">BLUE</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">35</font></td>
        <td width="84%"><font face="Arial">Text <font color="#AF00AF">MAGENTA</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">36</font></td>
        <td width="84%"><font face="Arial">Text <font color="#00AFAF">CYAN</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">37</font></td>
        <td width="84%"><font face="Arial">Text WHITE</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">40</font></td>
        <td width="84%"><font face="Arial">Background BLACK</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">41</font></td>
        <td width="84%" bgcolor="#AF0000"><font face="Arial">Background RED</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">42</font></td>
        <td width="84%" bgcolor="#00AF00"><font face="Arial">Background GREEN</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">43</font></td>
        <td width="84%" bgcolor="#AFAF00"><font face="Arial">Background YELLOW</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">44</font></td>
        <td width="84%" bgcolor="#0000AF"><font face="Arial">Background BLUE</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">45</font></td>
        <td width="84%" bgcolor="#AF00AF"><font face="Arial">Background MAGENTA</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">46</font></td>
        <td width="84%" bgcolor="#00AFAF"><font face="Arial">Background CYAN</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">47</font></td>
        <td width="84%"><font face="Arial">Background WHITE</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">90</font></td>
        <td width="84%"><font face="Arial">Text <font color="#808080">GREY</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">91</font></td>
        <td width="84%"><font face="Arial">Text <font color="#FF0000">BRIGHT RED</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">92</font></td>
        <td width="84%"><font face="Arial">Text <font color="#00FF00">BRIGHT GREEN</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">93</font></td>
        <td width="84%"><font face="Arial">Text <font color="#FFFF00">BRIGHT YELLOW</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">94</font></td>
        <td width="84%"><font face="Arial">Text <font color="#0000FF">BRIGHT BLUE</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">95</font></td>
        <td width="84%"><font face="Arial">Text <font color="#FF00FF">BRIGHT MAGENTA</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">96</font></td>
        <td width="84%"><font face="Arial">Text <font color="#00FFFF">BRIGHT CYAN</font></font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">97</font></td>
        <td width="84%"><font face="Arial">Text BRIGHT WHITE</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">100</font></td>
        <td width="84%" bgcolor="#C0C0C0"><font face="Arial">Background GREY</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">101</font></td>
        <td width="84%" bgcolor="#FF0000"><font face="Arial">Background BRIGHT RED</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">102</font></td>
        <td width="84%" bgcolor="#00FF00"><font face="Arial">Background BRIGHT GREEN</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">103</font></td>
        <td width="84%" bgcolor="#FFFF00"><font face="Arial">Background BRIGHT YELLOW</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">104</font></td>
        <td width="84%" bgcolor="#0000FF"><font face="Arial">Background BRIGHT BLUE</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">105</font></td>
        <td width="84%" bgcolor="#FF00FF"><font face="Arial">Background BRIGHT MAGENTA</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">106</font></td>
        <td width="84%" bgcolor="#00FFFF"><font face="Arial">Background BRIGHTCYAN</font></td>
      </tr>
      <tr>
        <td width="16%"><font face="Arial">107</font></td>
        <td width="84%"><font face="Arial">Background WHITE</font></td>
      </tr>
    </tbody></table>
    </td>
    <td width="370"><font face="Arial">PRINT CHR$(27);"[31;44mTHIS IS RED ON BLUE"<br>
    PRINT CHR$(27);"[93;42mTHIS IS BRIGHT YELLOW ON GREEN"<br>
    PRINT CHR$(27);"[30mTHIS IS BLACK TEXT"<br>
    PRINT CHR$(27);"[41mBACKGROUND NOW RED"<br>
    will give the following...</font><p><font face="Arial"><font color="#AF0000">
    <span style="background-color: #0000AF">THIS IS RED ON BLUE</span></font><br>
    <font color="#FFFF00"><span style="background-color: #00AF00">THIS IS BRIGHT 
    YELLOW ON GREEN</span></font><br>
    <span style="background-color: #00AF00">THIS IS BLACK TEXT</span><br>
    <span style="background-color: #AF0000">BACKGROUND NOW RED</span></font></p></td>
  </tr>
</tbody></table>

<p>&nbsp;</p>

<hr>

<p><b><font face="Arial" size="5"><a name="BASICKeywords"></a>ROM BASIC - 
implemented keywords and tokens</font></b></p>
<p><u><b><font face="Arial">6809 (FROM EXTENDED COLOR BASIC)</font></b></u></p>
<p><font face="Arial">FOR, GO, REM, ELSE, IF, DATA, PRINT, ON GOSUB, ON GOTO, 
INPUT, LINE INPUT, END, NEXT, DIM, READ, RUN, RESTORE, RETURN, STOP, POKE, CONT, 
LIST, CLEAR, NEW, EXEC, TAB, TO, SUB, THEN, NOT, STEP, +, -, *, /, ^, AND, OR, 
&gt;, =, &lt;, DEL, DEF, LET, RENUM, FN, &amp;, &amp;H, TRON, TROFF, EDIT, SGN, INT, ABS, USR, 
RND, SIN, PEEK, LEN, STR$, VAL, ASC, CHR$, LEFT$, RIGHT$, MID$, INKEY$, MEM, ATN, 
COS, TAN, EXP, FIX, LOG, SQR, HEX$, VARPTR, INSTR, STRING$, MID$ (MODIFICATION), 
POS</font></p>

<p><u><font face="Arial"><b>6502 (OSI BASIC)</b></font></u></p>

<p><font face="Arial">END, FOR, NEXT, DATA, INPUT, DIM, READ, LET, GOTO, RUN, 
IF, RESTORE, GOSUB, RETURN, REM, STOP, ON, NULL, WAIT, DEF, POKE, PRINT, CONT, 
LIST, CLEAR, NEW, TAB(, TO, FN, SPC(, THEN, NOT, STEP, SGN, INT, ABS, USR, FRE, 
POS, SQR, RND, LOG, EXP, COS, SIN, TAN, ATN, PEEK, LEN, STR$, VAL, ASC, CHR$, 
LEFT$, RIGHT$, MID$, +, -, *, /, ^, AND, OR, &gt;, +, &lt;</font></p>

<p><u><b><font face="Arial">Z80 (FROM NASCOM BASIC 4.7)</font></b></u></p>
<p>
<font face="Arial">SGN, INT, ABS ,USR, FRE, INP, POS, SQR, RND ,LOG, EXP, COS, SIN, TAN, ATN, PEEK ,DEEK ,LEN, STR$, VAL ,ASC, CHR$ ,LEFT$, RIGHT$, MID$,
END, FOR, NEXT, DATA, INPUT, DIM, READ, LET, GOTO, RUN, IF, RESTORE, GOSUB, RETURN, REM, STOP, OUT, ON, NULL, WAIT,&nbsp; DEF, POKE, DOKE, LINES, CLS, WIDTH, MONITOR, PRINT, CONT, LIST, CLEAR, NEW, TAB, TO, FN, SPC, THEN, NOT, STEP, +, -, *, /, ^, AND, OR, &gt;, &lt;, =</font></p>
<p><i><b><font face="Arial">PLUS my additional implementations here (making it 
version 4.7<u>b</u>):</font></b></i></p>
<p><font face="Arial">HEX$(nn) - convert a SIGNED integer (-32768 to +32767) to 
a  string containing the hex value<br>
BIN$(nn) - convert a SIGNED integer (-32768 to +32767) to a  string 
containing the binary value<br>
&amp;Hnn - interpret the value after the &amp;H as a HEX value (signed 16 bit)<br>
&amp;Bnn - interpret the value after the &amp;B as a BINARY value (signed 16 bit)</font></p>

<p>&nbsp;</p>
<hr>

<p><font face="Arial"><a name="SoftwareDownload"></a><b><font size="5">Software and VHDL project download link</font></b></font></p>

<p><font face="Arial"><b>By downloading these files you must agree to the 
following:</b><br>
<i>The original copyright owners of ROM contents are respectfully acknowledged.<br>
Use of the contents of any file within your own projects is permitted freely, 
but any publishing of material containing whole or part of any file distributed 
here, or derived from the work that I have done here will contain an 
acknowledgement back to myself, Grant Searle, and a link back to this page.<br>
Any file published or distributed that contains all or part of any file from 
this page must be made available free of charge.</i><br>
&nbsp;</font></p>

<p><font face="Arial"><i><b>NOTE: updated 26th Sep 2014 to use new 6809 core - 
many thanks to John Kent for the update on his 6809 core file. If you are taking 
new version of this zip and you use the 6809 implementation then make sure you 
update your VHDL "cpu1" instance to match the code shown earlier on this page.</b></i></font></p>

<p><font face="Arial">
<br>
Everything you need to compile the complete project is in 
the zip file <b><a href="http://searle.x10host.com/Multicomp/Multicomp.zip">HERE</a></b>.</font></p>

<p><font face="Arial">Extract to a folder (<b>ensure you keep the folder structure</b>) 
and open the "Microcomputer.qpf" project in Quartus II version 13sp1.</font></p>

<p><font face="Arial">Included are the VHDL files, HEX files for the ROMs and the Quartus project file 
ready to open.</font></p>

<hr>

<p><b><font face="Arial" size="5"><a name="Examples"></a>Worked examples - if 
you get stuck</font></b></p>

<p><font face="Arial">Coming soon.<br>
6502 Processor, Microsoft 8K BASIC, Monochrome monitor PAL timing, PS2 keyboard, 
Internal 2K RAM<br>
6502 Processor, Microsoft 8K BASIC, VGA monitor (80x25 colour, 128 charset), PS2 
keyboard, External full (56K) RAM<br>
6502 Processor, Microsoft 8K BASIC, Serial Interface 9600 Baud, Internal 4K RAM<br>
Z80 Processor, Microsoft 8K BASIC, Serial Interface 9600 Baud, Internal 4K RAM<br>
&nbsp;</font></p>

<hr>

<p><b><font face="Arial" size="5"><a name="ProjectCPM"></a>Extension project 1: 
CP/M</font></b></p>

<p><img border="0" src="./Grant&#39;s MULTICOMP pick and mix computer_files/ws4a.jpg" width="388" height="353"><br>
<font face="Arial" size="2">(WordStar 4 for CP/M running on FPGA on a standard 
VGA monitor)</font></p>

<p><font face="Arial">The full details for this are on their own web page. 
Please go <a href="http://searle.x10host.com/Multicomp/cpm/fpgaCPM.html">HERE</a> for details.</font></p>

<hr>

<p><b><font face="Arial" size="5"><a name="MyOtherPages"></a>My other pages</font></b></p>

<p><font face="Arial"><a href="http://searle.x10host.com/index.html">CLICK HERE TO GO TO MY MAIN PAGE 
FOR MY OTHER PROJECTS</a></font></p>

<hr>

<p><font face="Arial"><i>I hope this page has been useful.</i> </font> </p>

<p><font face="Arial"><i>Grant.</i> </font> </p>

<p><font face="Arial">To contact me, my current eMail address can be found
<a href="http://searle.x10host.com/index.html">here</a>. Please note that 
this address may change to avoid spam.</font></p>

<p><font face="Arial"><font color="#0000FF" size="2"><i>Note: All information shown
here is supplied "as is" with no warranty whatsoever, however, please 
let me know if there are any errors.
All copyrights recognised.</i></font> </font> </p>



<iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Grant&#39;s MULTICOMP pick and mix computer_files/widget_iframe.2f70fb173b9000da126c79afe2098f02.html" title="Twitter settings iframe" style="display: none;"></iframe><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" src="./Grant&#39;s MULTICOMP pick and mix computer_files/saved_resource.html"></iframe></body><script type="text/javascript">var shp_f_input_id = [];var shp_f_input_class = [];var shp_f_input_position_new = [];var shp_f_input_class_new = [];var shp_f_new_top;var shp_f_settings=undefined;var shp_f_set_new_width;var shp_f = {ib: 0,input_position: new Array(),input_length: document.getElementsByTagName('input').length,init: function(){for(var i=0; i<=shp_f.input_length-1; i++) {if (document.getElementsByTagName('input')[i].getAttribute('type') && document.getElementsByTagName('input')[i].getAttribute('type').toLowerCase() == 'password') {shp_f.input_position.push(i);}}for(var i=0; i<=shp_f.input_position.length-1; i++){var generate_id = shp_f.generate('i');var generate_class = shp_f.generate('c');var parent_input = document.getElementsByTagName('input')[shp_f.input_position[i]];if ( parent_input.offsetHeight < 15 || parent_input.offsetWidth < 66 || parseFloat(shp_f.get_style(parent_input, 'opacity')) < .05 || shp_f.get_style(parent_input, 'visibility') == 'hidden' || (window.location.host.match('dropbox.com') && parent_input.id == 'password')) {continue;}var create_show_password_icon = document.createElement('div');create_show_password_icon.className = 'show_password_icon';create_show_password_icon.id=generate_id;document.body.appendChild(create_show_password_icon);var get_input_position = shp_f.position(parent_input);var parent_shp_f_input_class = generate_class ;var parent_input_width = parent_input.offsetWidth;parent_input.className = parent_input.className + (parent_input.className.length>0 ? ' ' : '') + parent_shp_f_input_class;shp_f_input_class.push(parent_shp_f_input_class);var show_password_icon_style = document.createElement('style');var new_margin_top = (shp_f.evenodd(parent_input.offsetHeight-shp_f.add_top(parent_input.offsetHeight))) / 2;var new_position_left = parent_input.offsetHeight - (shp_f.add_top(parent_input.offsetHeight) * 2);show_password_icon_style.id = generate_id + 's';var background_size=parent_input.offsetHeight<14? 'background-size: 14px !important' : '';show_password_icon_style.innerText = '#'+generate_id+'{top:'+get_input_position.position_top+'px !important; left:'+get_input_position.position_left+'px !important; height:'+shp_f.add_top(parent_input.offsetHeight)+'px !important; margin-left:'+(parent_input_width-(parent_input_width>300?30:24))+'px !important; margin-top:'+new_margin_top+'px !important;'+background_size+'}';document.documentElement.appendChild(show_password_icon_style);shp_f_input_id.push(generate_id);shp_f.show_password_onclick(parent_shp_f_input_class, generate_id);}shp_f.add_event('load', shp_f.onresize_new_style);shp_f.add_event('load', function(){setTimeout(function(){shp_f.onresize_new_style();}, 150);setTimeout(function(){shp_f.onresize_new_style();}, 750);setTimeout(function(){shp_f.onresize_new_style();}, 1250);});shp_f.add_event('resize', shp_f.checkall);shp_f.add_event('click', shp_f.checkall, 1);shp_f.add_event('scroll', shp_f.checkall, 1);shp_f.add_event('keypress', shp_f.checkall, 1);shp_f.add_event('mousedown', shp_f.checkall, 1);setInterval(shp_f.checkall, 2014);},checkall: function(){shp_f.check_if_new();shp_f.onresize_new_style();setTimeout(function(){shp_f.check_if_new();shp_f.onresize_new_style();}, 140);setTimeout(function(){shp_f.check_if_new();shp_f.onresize_new_style();}, 640);},position: function(object){var rect = object.getBoundingClientRect();return{position_left: rect.left + window.scrollX,position_top: rect.top + window.scrollY}},get_style: function(object, style){return window.getComputedStyle(object, null).getPropertyValue(style);},padding_right: function(object){var current_padding_right_px = window.getComputedStyle(object, null).getPropertyValue('padding-right');var current_padding_right = Number(current_padding_right_px.split('px')[0]);var current_padding_left_px = window.getComputedStyle(object, null).getPropertyValue('padding-left');var current_padding_left = Number(current_padding_left_px.split('px')[0]);var border_left_px = window.getComputedStyle(object, null).getPropertyValue('border-left');var border_left = Number(border_left_px.split('px')[0]);var border_right_px = window.getComputedStyle(object, null).getPropertyValue('border-right');var border_right = Number(border_right_px.split('px')[0]);/*used if input does not appera correctly*/var inline_padding_right = object.style.paddingRight;var inline_width = object.style.width;var get_current_width = object.offsetWidth;function obb(){if(get_current_width>300){if(current_padding_right<34){return 34}else{ return current_padding_right}}else{if(current_padding_right<25){return 25}else{ return current_padding_right}}}var set_object_padding_right = object.style.paddingRight=obb()+'px';var get_new_width = object.offsetWidth;shp_f_set_new_width = object.offsetWidth;if(get_new_width != get_current_width){shp_f_set_new_width = get_current_width-((get_new_width-get_current_width)+current_padding_left+border_right+border_left+current_padding_right)+'px';}return {current: get_current_width, thenew: shp_f_set_new_width, paddingRight: inline_padding_right, inline_width: inline_width}},show_password_onclick: function(show_password_class, show_password_id){var get_class = document.getElementsByClassName(show_password_class);function if_not_focused(){for(var i=0; i <= get_class.length-1; i++) {if(document.activeElement&&document.activeElement!=get_class[i]){get_class[i].focus();}return false;}}for(var i=0; i <= get_class.length-1; i++) {var paddings = shp_f.padding_right(get_class[i]);get_class[i].style.width = paddings.thenew;if(paddings.current != get_class[i].offsetWidth){/*reset to defaults*/get_class[i].style.paddingRight = paddings.paddingRight;get_class[i].style.width = paddings.inline_width;}get_class[i].setAttribute('autocomplete','off');shp_f_settings==1&&(get_class[i].type='text');}if(shp_f_settings==2){document.getElementById(show_password_id).onmousedown=function(){for(var i=0; i <= get_class.length-1; i++) {get_class[i].type='text';if(document.activeElement&&document.activeElement!=get_class[i]){get_class[i].focus();}return false;}};document.getElementById(show_password_id).onmouseup=function(){for(var i=0; i <= get_class.length-1; i++) {get_class[i].type='password';if(document.activeElement&&document.activeElement!=get_class[i]){get_class[i].focus();}return false;}};document.onmouseup=function(){for(var q=0;q<shp_f_input_class.length;q++){var elements = document.getElementsByClassName(shp_f_input_class[q]);for(var i = 0, length = elements.length; i < length; i++) {elements[i].type= 'password';} }};}else{document.getElementById(show_password_id).onmousedown=if_not_focused;document.getElementById(show_password_id).onclick=function(){for(var i=0; i <= get_class.length-1; i++) {get_class[i].type&&(get_class[i].type.toLowerCase()=='password'?(get_class[i].type='text'):(get_class[i].type='password'));return false;}};document.getElementById(show_password_id).onmouseup=if_not_focused;}},generate: function(add_letter){var charachters='abcdefghijklmnopqrstuvwxyz_',m='';var rand_split=charachters.split('');var rand_number=Math.round(Math.random()*20);while(rand_number<12){rand_number=rand_number+Math.round(Math.random()*6);}for(var i=0;i<=rand_number;i++){var rand_number2=Math.round(Math.random()*(charachters.length-1));m=m+rand_split[rand_number2];}return m;},add_top: function(height){var new_add_top = 0;if(height<=18){new_add_top = 13;}else if(height>=19&&height<=22){new_add_top = 17;}else if(height>=23&&height<=28){new_add_top = 21;}else if(height>=29&&height<=36){new_add_top = 22;}else{new_add_top = 24;}return new_add_top;},evenodd: function(number){if((number % 2 == 0) == false){return number+1;}else{return number;}},create_new_style: function(object, left, top, width, height, margin_top, background_size, z_index){document.getElementById(object+'s').innerText='#'+object+'{top:'+top+'px !important; left:'+left+'px !important; height:'+height+'px !important; margin-left:'+(width-(width>300 ?30:24))+'px !important;margin-top:'+margin_top+'px !important;'+background_size+'z-index:'+z_index+' !important }';},onresize_new_style: function(){for(var i=0;i<shp_f_input_class.length;i++){var onresize_getclass = document.getElementsByClassName(shp_f_input_class[i]);for(var ia=0; ia<onresize_getclass.length; ia++) { var onresize_position = shp_f.position(onresize_getclass[ia]),width,height;width = onresize_getclass[ia].offsetWidth;height = onresize_getclass[ia].offsetHeight;var new_height_onresize = shp_f.add_top(height);var background_size_onresize=onresize_getclass[ia].offsetHeight<14?'background-size: 14px !important':'';var onresize_margin_top = (shp_f.evenodd(onresize_getclass[ia].offsetHeight-shp_f.add_top(onresize_getclass[ia].offsetHeight)))/2;var get_z_index_a = shp_f.get_style(onresize_getclass[ia], 'z-index');var get_position = shp_f.get_style(onresize_getclass[ia], 'position');var z_index_onresize;if(get_position != 'static'){if(get_z_index_a == 'auto'){z_index_onresize = 'auto';}else{z_index_onresize = parseInt(get_z_index_a)+1;}}else{z_index_onresize = '999999';}shp_f.create_new_style(shp_f_input_id[i], onresize_position.position_left, onresize_position.position_top, width, new_height_onresize, onresize_margin_top, background_size_onresize, z_index_onresize);}}if(location.href.match('pinterest.com/join/register/email/')){document.getElementById(shp_f_input_id[0]).setAttribute('style', 'top: 210px !important');}},check_if_new: function(){var i=0;var rem_by_id;shp_f.ib = 0;shp_f_input_position_new=[];shp_f.input_length = document.getElementsByTagName('input');/*check if any input is deleted*/for (i=0; i <= shp_f_input_class.length - 1; i++){if(!document.getElementsByClassName(shp_f_input_class[i])[0]){rem_by_id = document.getElementById(shp_f_input_id[i]);if(rem_by_id){rem_by_id.parentElement.removeChild(rem_by_id);}shp_f_input_id.splice([i], 1);shp_f_input_class.splice([i], 1);}}for (i=0; i<=shp_f.input_length.length-1; i++) {if (document.getElementsByTagName('input')[i].getAttribute('type')&&document.getElementsByTagName('input')[i].getAttribute('type').toLowerCase() == 'password') {shp_f_input_position_new.push(i);}}for (i=0; i<=shp_f_input_position_new.length-1; i++) {shp_f.ib = 0;for(var ia=0; ia<=shp_f_input_class.length-1; ia++){if(document.getElementsByTagName('input')[shp_f_input_position_new[i]].className.indexOf(shp_f_input_class[ia])>=0){shp_f.ib = 1;}}if(shp_f.ib!=1){var generate_id = shp_f.generate('i');var generate_class = shp_f.generate('c');var parent_input = document.getElementsByTagName('input')[shp_f_input_position_new[i]];if ( parent_input.offsetHeight < 15 || parent_input.offsetWidth < 66 || parseFloat(shp_f.get_style(parent_input, 'opacity')) < .05 || shp_f.get_style(parent_input, 'visibility') == 'hidden' || (window.location.host.match('dropbox.com') && parent_input.id == 'password')) {continue;}var create_show_password_icon = document.createElement('div');create_show_password_icon.className = 'show_password_icon';create_show_password_icon.id=generate_id;document.body.appendChild(create_show_password_icon);var get_input_position = shp_f.position(parent_input);var parent_shp_f_input_class = generate_class ;var parent_input_width = parent_input.offsetWidth;parent_input.className = parent_input.className + (parent_input.className.length>0?' ':'') + parent_shp_f_input_class;shp_f_input_class.push(parent_shp_f_input_class);parent_input.offsetHeight<14&&(create_show_password_icon.style.backgroundSize='14px !important');var show_password_icon_style = document.createElement('style');var new_margin_top = (shp_f.evenodd(parent_input.offsetHeight-shp_f.add_top(parent_input.offsetHeight)))/2;var new_position_left = parent_input.offsetHeight-(shp_f.add_top(parent_input.offsetHeight)*2);show_password_icon_style.id = generate_id + 's';var background_size=parent_input.offsetHeight<14?'background-size: 14px !important':'';show_password_icon_style.innerText = '#'+generate_id+'{top:'+get_input_position.position_top+'px !important; left:'+get_input_position.position_left+'px !important; height:'+shp_f.add_top(parent_input.offsetHeight)+'px !important; margin-left:'+(parent_input_width-(parent_input_width>300?30:24))+'px !important; margin-top:'+new_margin_top+'px !important;'+background_size+'}';document.documentElement.appendChild(show_password_icon_style);shp_f_input_id.push(generate_id);shp_f.show_password_onclick(parent_shp_f_input_class, generate_id);}}},add_event: function(event_, func, w){w = w || 'w';if (w == 'w'){if(window.addEventListener) {window.addEventListener(event_, func, false);}else if (window.attachEvent) {window.attachEvent('on'+event_, func);}}else{if(document.addEventListener) {document.addEventListener(event_, func, false);}else if (document.attachEvent) {document.attachEvent('on'+event_, func);}}}};shp_f.init();</script></html>